<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶„ë§ ê²€ì‚¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* í˜ì´ì§€ë³„ í‘œì‹œ/ìˆ¨ê¹€ */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* ê³µí†µ í—¤ë” */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ */
        .nav-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .nav-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .nav-btn.secondary {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }
        
        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */
        .dashboard-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .incomplete-list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .incomplete-list th,
        .incomplete-list td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .incomplete-list th {
            background-color: #667eea;
            color: white;
            font-weight: bold;
        }
        
        .incomplete-list tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .incomplete-list tr:hover {
            background-color: #e3f2fd;
            cursor: pointer;
        }
        
        .progress-bar {
            background-color: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8em;
            font-weight: bold;
            color: #333;
        }
        
        .empty-message {
            text-align: center;
            color: #666;
            font-size: 1.1em;
            padding: 40px;
            font-style: italic;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1em;
            color: #666;
        }
        
        .loading::after {
            content: '...';
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0%, 20% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 400px;
            max-width: 90%;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .modal-buttons {
            text-align: right;
            margin-top: 20px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            margin-left: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .modal-btn.cancel {
            background: #666;
            color: white;
        }
        
        .modal-btn.primary {
            background: #4CAF50;
            color: white;
        }
        
        /* ê²€ì‚¬ ì…ë ¥ ìŠ¤íƒ€ì¼ */
        .inspection-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .info-group {
            display: flex;
            gap: 30px;
        }
        
        .info-item {
            font-size: 1.1em;
        }
        
        .info-label {
            font-weight: bold;
            color: #555;
            margin-right: 8px;
        }
        
        .inspection-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        
        .inspection-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .inspection-card:hover {
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .item-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }
        
        .spec-range {
            font-size: 0.9em;
            color: #666;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 15px;
        }
        
        .measurement-inputs {
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center; /* ì¶”ê°€ */
        }

        .input-group label {
            flex: 0 0 60px;
            font-weight: bold;
            color: #555;
            display: flex;
            align-items: center;
        }

        .input-group input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            min-width: 0; /* ì¶”ê°€ - flex ì•„ì´í…œì´ ì¶•ì†Œë  ìˆ˜ ìˆë„ë¡ */
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        .unit {
            flex: 0 0 60px;
            display: flex;
            align-items: center;
            color: #666;
            font-size: 0.9em;
            white-space: nowrap; /* ì¶”ê°€ - í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }
        
        .calculation-result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .avg-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .avg-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        
        .result-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .result-status.pass {
            background: #4CAF50;
            color: white;
        }
        
        .result-status.fail {
            background: #f44336;
            color: white;
        }
        
        .result-status.pending {
            background: #ff9800;
            color: white;
        }
        
        .save-btn {
            width: 100%;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .save-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .save-btn.saved {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }
        
        /* ê²€ì‚¬ ê²°ê³¼ ì¡°íšŒ ìŠ¤íƒ€ì¼ */
        .search-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }
        
        .search-btn {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            min-width: 1200px;
        }

        /* í…Œì´ë¸” ì»¨í…Œì´ë„ˆì— ìŠ¤í¬ë¡¤ ì¶”ê°€ */
        .results-container {
            overflow: auto;
            max-height: 60vh;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .results-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .results-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .results-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .results-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* ê¸°ë³¸ ì •ë³´ ì»¬ëŸ¼ë“¤ (ê²€ì‚¬ì‹œê°„, ê²€ì‚¬íƒ€ì…, ë¶„ë§ëª…, LOTë²ˆí˜¸, ê²€ì‚¬ì) */
        .basic-info-cell {
            min-width: 120px;
            white-space: nowrap;
            padding: 12px 8px;
            font-size: 0.9em;
        }

        /* ê²€ì‚¬ì‹œê°„ ì „ìš© ìŠ¤íƒ€ì¼ */
        .inspection-time-cell {
            min-width: 100px;
            font-size: 0.85em;
        }

        /* ë¶„ë§ëª…/LOTë²ˆí˜¸/ê²€ì‚¬ì ì…€ ìŠ¤íƒ€ì¼ */
        .info-cell {
            min-width: 100px;
            max-width: 150px;
            word-wrap: break-word;
            white-space: normal;
            line-height: 1.2;
        }

        /* ê²€ì‚¬ ê²°ê³¼ ì»¬ëŸ¼ë“¤ (ìµœì¢…ê²°ê³¼ë¶€í„°) - ë™ì¼í•œ ë„ˆë¹„ */
        .result-column {
            min-width: 80px;
            max-width: 80px;
            text-align: center;
            padding: 8px 4px;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .results-container::-webkit-scrollbar {
            height: 8px;
        }

        .results-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .results-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .results-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .results-table th,
        .results-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            font-size: 0.9em;
        }
        
        .results-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            text-align: center;
        }
        
        .results-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .results-table tr:hover {
            background-color: #e3f2fd;
        }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .nav-buttons {
                flex-direction: column;
            }
            
            .info-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .inspection-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .inspection-items {
                grid-template-columns: 1fr;
            }
            
            .search-form {
                grid-template-columns: 1fr;
            }
        }

        /* ì…ë„ë¶„ì„ ì „ìš© ìŠ¤íƒ€ì¼ */
        .particle-size-inputs {
            margin-bottom: 20px;
        }

        .mesh-group {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .mesh-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #dee2e6;
        }

        .mesh-name {
            font-weight: bold;
            color: #495057;
            font-size: 1.1em;
        }

        .mesh-spec {
            font-size: 0.9em;
            color: #6c757d;
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .mesh-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .mesh-result .result-status {
            font-size: 0.8em;
            padding: 4px 8px;
        }

        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 768px) {
            .mesh-header {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
            
            .mesh-result {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
        }

        /* ë°”ì½”ë“œ ìŠ¤ìº” ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .barcode-scanner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            display: none;
        }

        .scanner-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .scanner-header {
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .scanner-header h2 {
            margin: 0 0 10px 0;
            font-size: 1.5em;
        }

        .scanner-area {
            width: 400px;
            height: 300px;
            border: 2px solid #fff;
            position: relative;
            background: #000;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* Quagga ì¹´ë©”ë¼ ì˜ìƒ ì¤‘ì•™ ì •ë ¬ */
        .scanner-area canvas,
        .scanner-area video {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }

        .scanner-area .drawingBuffer {
            position: absolute;
            top: 0;
            left: 0;
        }

        .scanner-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .scanner-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            min-width: 120px;
        }

        .scanner-btn.close {
            background: #f44336;
            color: white;
        }

        .scanner-btn.manual {
            background: #2196F3;
            color: white;
        }

        /* ìµœì¢…ê²°ê³¼ ì…€ ìŠ¤íƒ€ì¼ ì¶”ê°€ (ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì„¹ì…˜ì— ì¶”ê°€) */
        .final-result-cell {
            background-color: #fff3cd !important;
            font-weight: bold;
            min-width: 80px;
            max-width: 80px;
            text-align: center;
        }

        .final-result-cell .result-status.pass {
            background: #28a745;
            color: white;
        }

        .final-result-cell .result-status.fail {
            background: #dc3545;
            color: white;
        }

        /* ê²€ì‚¬ ìƒì„¸ ì¡°íšŒ ì „ìš© ìŠ¤íƒ€ì¼ */
        .inspection-detail-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: none; /* í˜¸ë²„ íš¨ê³¼ ì œê±° */
        }

        .inspection-detail-card:hover {
            transform: none; /* í˜¸ë²„ íš¨ê³¼ ì œê±° */
        }

        .detail-input-group input {
            background-color: #f8f9fa;
            color: #495057;
            cursor: not-allowed;
        }

        .detail-result-display {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #6c757d;
        }

        .detail-result-display.pass {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .detail-result-display.fail {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .detail-measurement-values {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-value-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .detail-value-label {
            font-size: 0.8em;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .detail-value-number {
            font-size: 1.1em;
            font-weight: bold;
            color: #495057;
        }

        .detail-average {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
            margin: 10px 0;
        }

        /* ì…ë„ë¶„ì„ ìƒì„¸ í‘œì‹œ ê°œì„  */
        .particle-size-inputs .mesh-group {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #6c757d;
        }

        .particle-size-inputs .mesh-group:hover {
            background: #e9ecef;
            transition: background-color 0.2s ease;
        }

        .particle-size-inputs .mesh-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }

        .particle-size-inputs .mesh-name {
            font-weight: bold;
            color: #495057;
            font-size: 1.1em;
        }

        .particle-size-inputs .mesh-spec {
            font-size: 0.9em;
            color: #6c757d;
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
        }

        .particle-size-inputs .detail-measurement-values {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .particle-size-inputs .detail-value-item {
            text-align: center;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .particle-size-inputs .detail-value-label {
            font-size: 0.85em;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .particle-size-inputs .detail-value-number {
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
        }

        .particle-size-inputs .mesh-result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        /* ì…ë„ë¶„ì„ ì „ì²´ ê²°ê³¼ ìŠ¤íƒ€ì¼ */
        .particle-size-inputs + .detail-result-display {
            margin-top: 20px;
            border-left: 4px solid #28a745;
            background: #d4edda;
        }

        .particle-size-inputs + .detail-result-display.fail {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        /* ê¸°ì¡´ CSSì— ì¶”ê°€ */
        .spec-range {
            font-size: 0.9em;
            color: #666;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .spec-range .spec-info {
            color: #495057;
            font-weight: bold;
            font-size: 0.85em;
        }

        .mesh-spec {
            font-size: 0.9em;
            color: #6c757d;
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ê²‰ë³´ê¸°ë°€ë„ ì „ìš© ìŠ¤íƒ€ì¼ */
        .apparent-density-inputs {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .apparent-density-row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap; /* ì¶”ê°€ - í™”ë©´ì´ ì‘ì„ ë•Œ ì¤„ë°”ê¿ˆ */
        }

        .apparent-density-row label {
            flex: 0 0 50px;
            font-weight: bold;
            color: #555;
            font-size: 0.9em;
        }

        .apparent-density-row input {
            flex: 1;
            min-width: 80px; /* ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
            max-width: 120px; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .apparent-density-row .unit {
            flex: 0 0 40px;
            font-size: 0.8em;
            color: #666;
            text-align: center;
        }

        .apparent-density-row .calculated-value {
            flex: 0 0 60px;
            font-size: 0.8em;
            color: #333;
            font-weight: bold;
            text-align: center;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }

        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 768px) {
            .apparent-density-row {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            .apparent-density-row input {
                max-width: none;
            }
        }

        /* ì‘ì—… ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .action-cell {
            min-width: 180px;
            padding: 8px !important;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
            align-items: center;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: bold;
            transition: all 0.2s ease;
            min-width: 50px;
            white-space: nowrap;
        }

        .view-btn {
            background-color: #2196F3;
            color: white;
        }

        .view-btn:hover {
            background-color: #1976D2;
            transform: translateY(-1px);
        }

        .edit-btn {
            background-color: #FF9800;
            color: white;
        }

        .edit-btn:hover {
            background-color: #F57C00;
            transform: translateY(-1px);
        }

        .delete-btn {
            background-color: #f44336;
            color: white;
        }

        .delete-btn:hover {
            background-color: #d32f2f;
            transform: translateY(-1px);
        }

        .action-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }


    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ë¶„ë§ ê²€ì‚¬ ì‹œìŠ¤í…œ</h1>
            <p>Powder Inspection Management System</p>
        </div>
        
        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="nav-buttons">
            <button class="nav-btn" onclick="showPage('dashboard')">ëŒ€ì‹œë³´ë“œ</button>
            <button class="nav-btn" onclick="showNewInspectionModal()">ìƒˆ ê²€ì‚¬ ì‹œì‘</button>
            <button class="nav-btn" onclick="startBarcodeScanning()" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">ë°”ì½”ë“œ ìŠ¤ìº”</button>
            <button class="nav-btn secondary" onclick="showPage('search')">ê²€ì‚¬ê²°ê³¼ ì¡°íšŒ</button>
        </div>
        
        <!-- ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ -->
        <div id="dashboardPage" class="page active">
            <div class="dashboard-section">
                <h2 class="section-title">ë¯¸ì™„ë£Œ ê²€ì‚¬ ëª©ë¡</h2>
                <button onclick="loadIncompleteInspections()" style="background: #f44336; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; float: right; margin-bottom: 20px;">ìƒˆë¡œê³ ì¹¨</button>
                <div style="clear: both;"></div>
                
                <div id="loadingMessage" class="loading">ë¯¸ì™„ë£Œ ê²€ì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘</div>
                
                <div id="incompleteInspections" style="display: none;">
                    <table class="incomplete-list">
                        <thead>
                            <tr>
                                <th>ë¶„ë§ëª…</th>
                                <th>LOTë²ˆí˜¸</th>
                                <th>ê²€ì‚¬íƒ€ì…</th>
                                <th>ê²€ì‚¬ì</th>
                                <th>ì‹œì‘ì‹œê°„</th>
                                <th>ì§„í–‰ë¥ </th>
                            </tr>
                        </thead>
                        <tbody id="inspectionTableBody">
                        </tbody>
                    </table>
                </div>
                
                <div id="emptyMessage" class="empty-message" style="display: none;">
                    í˜„ì¬ ì§„í–‰ì¤‘ì¸ ê²€ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>
        
        <!-- ê²€ì‚¬ ì…ë ¥ í˜ì´ì§€ -->
        <div id="inspectionPage" class="page">
            <div class="inspection-info">
                <div class="info-group">
                    <div class="info-item">
                        <span class="info-label">ë¶„ë§ëª…:</span>
                        <span id="inspectionPowderName">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">LOTë²ˆí˜¸:</span>
                        <span id="inspectionLotNumber">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ê²€ì‚¬íƒ€ì…:</span>
                        <span id="inspectionType">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ê²€ì‚¬ì:</span>
                        <span id="inspectionInspector">-</span>
                    </div>
                </div>
                <button class="nav-btn" id="backToDashboardBtn" onclick="showPage('dashboard')">ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
            
            <div class="dashboard-section" style="margin-bottom: 20px;">
                <h3>ê²€ì‚¬ ì§„í–‰ ìƒí™©</h3>
                <div class="progress-bar" style="margin-top: 10px;">
                    <div class="progress-fill" id="inspectionProgressFill" style="width: 0%"></div>
                    <div class="progress-text" id="inspectionProgressText">0/0</div>
                </div>
            </div>
            
            <div class="inspection-items" id="inspectionItems">
                <!-- ê²€ì‚¬ í•­ëª©ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
        
        <!-- ê²€ì‚¬ ê²°ê³¼ ì¡°íšŒ í˜ì´ì§€ -->
        <div id="searchPage" class="page">
            <div class="search-section">
                <div class="search-form">
                    <div class="form-group">
                        <label for="searchPowderSelect">ë¶„ë§ëª…</label>
                        <select id="searchPowderSelect">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="searchLotNumber">LOTë²ˆí˜¸</label>
                        <input type="text" id="searchLotNumber" placeholder="ì „ì²´ ì¡°íšŒì‹œ ë¹„ì›Œë‘ì„¸ìš”">
                    </div>
                    
                    <div class="form-group">
                        <label for="searchStartDate">ì‹œì‘ì¼</label>
                        <input type="date" id="searchStartDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="searchEndDate">ì¢…ë£Œì¼</label>
                        <input type="date" id="searchEndDate">
                    </div>
                    
                    <div class="form-group">
                        <button class="search-btn" onclick="executeSearch()">ê²€ìƒ‰</button>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="section-title" style="margin: 0;">ê²€ì‚¬ ê²°ê³¼</h2>
                    <span id="searchResultsCount">ê²€ìƒ‰ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”</span>
                </div>
                
                <div id="searchLoadingMessage" style="display: none;" class="loading">
                    ê²€ì‚¬ ê²°ê³¼ë¥¼ ì¡°íšŒí•˜ëŠ” ì¤‘
                </div>
                
                <div id="searchEmptyResults" class="empty-message" style="display: none;">
                    <div style="font-size: 3em; margin-bottom: 20px; opacity: 0.5;">ğŸ“Š</div>
                    <div>ì¡°íšŒëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">
                        ê²€ìƒ‰ ì¡°ê±´ì„ ë³€ê²½í•˜ì—¬ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.
                    </div>
                </div>
                
                <!-- ê²€ì‚¬ ê²°ê³¼ í‘œì‹œ ë¶€ë¶„ ìˆ˜ì • -->
                <div id="searchResults" style="display: none;">
                    <div class="results-container">
                        <table class="results-table" id="searchResultsTable">
                            <thead>
                                <tr id="searchTableHeader">
                                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                                </tr>
                            </thead>
                            <tbody id="searchTableBody">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ìƒˆ ê²€ì‚¬ ì‹œì‘ ëª¨ë‹¬ -->
    <div id="newInspectionModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px; color: #333;">ìƒˆ ê²€ì‚¬ ì‹œì‘</h3>
            
            <div class="form-group">
                <label>ë¶„ë§ëª…:</label>
                <select id="modalPowderSelect">
                    <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>LOTë²ˆí˜¸:</label>
                <input type="text" id="modalLotNumber" placeholder="LOTë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            
            <!-- ê¸°ì¡´ ê²€ì‚¬ì ì…ë ¥ í•„ë“œë¥¼ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë³€ê²½ -->
            <div class="form-group">
                <label>ê²€ì‚¬ì:</label>
                <select id="modalInspectorSelect">
                    <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                </select>
            </div>
            
            <div class="form-group">
                <label style="margin-bottom: 10px;">ê²€ì‚¬íƒ€ì…:</label>
                <div>
                    <input type="radio" id="modalDailyCheck" name="modalInspectionType" value="ì¼ìƒì ê²€" checked>
                    <label for="modalDailyCheck" style="margin-right: 20px; font-weight: normal;">ì¼ìƒì ê²€</label>
                    <input type="radio" id="modalRegularCheck" name="modalInspectionType" value="ì •ê¸°ì ê²€">
                    <label for="modalRegularCheck" style="font-weight: normal;">ì •ê¸°ì ê²€</label>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeNewInspectionModal()">ì·¨ì†Œ</button>
                <button class="modal-btn primary" onclick="submitNewInspection()">ì¡°íšŒ(ê²€ì‚¬ì‹œì‘)</button>
            </div>
        </div>
    </div>

    <!-- ë°”ì½”ë“œ ìŠ¤ìº” í™”ë©´ -->
    <div id="barcodeScanner" class="barcode-scanner">
        <div class="scanner-container">
            <div class="scanner-header">
                <h2>ë°”ì½”ë“œ ìŠ¤ìº”</h2>
                <p>ë°”ì½”ë“œë¥¼ ì¹´ë©”ë¼ì— ë§ì¶°ì£¼ì„¸ìš”</p>
            </div>
            
            <div class="scanner-area" id="scannerArea">
                <!-- ì¹´ë©”ë¼ ì˜ìƒì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <div class="scanner-controls">
                <button class="scanner-btn close" onclick="closeBarcodeScanner()">ì·¨ì†Œ</button>
                <button class="scanner-btn manual" onclick="showManualInput()">ìˆ˜ë™ ì…ë ¥</button>
            </div>
        </div>
    </div>

    <!-- ê²€ì‚¬ ìƒì„¸ ì¡°íšŒ í˜ì´ì§€ ì¶”ê°€ (ê¸°ì¡´ í˜ì´ì§€ë“¤ê³¼ ë™ì¼í•œ êµ¬ì¡°) -->
    <div id="inspectionDetailPage" class="page">
        <div class="inspection-info">
            <div class="info-group">
                <div class="info-item">
                    <span class="info-label">ë¶„ë§ëª…:</span>
                    <span id="detailPowderName">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">LOTë²ˆí˜¸:</span>
                    <span id="detailLotNumber">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ê²€ì‚¬íƒ€ì…:</span>
                    <span id="detailInspectionType">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ê²€ì‚¬ì:</span>
                    <span id="detailInspector">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ê²€ì‚¬ì‹œê°„:</span>
                    <span id="detailInspectionTime">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ìµœì¢…ê²°ê³¼:</span>
                    <span id="detailFinalResult">-</span>
                </div>
            </div>
            <button class="nav-btn" onclick="showPage('search')">ê²€ì‚¬ê²°ê³¼ ì¡°íšŒë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
        
        <div class="inspection-items" id="inspectionDetailItems">
            <!-- ê²€ì‚¬ í•­ëª©ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ (ì½ê¸° ì „ìš©) -->
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentInspections = [];
        let currentInspectionData = null;
        let currentInspectionItems = [];
        let completedItems = [];
        let searchResults = [];
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            loadPowderList();
            loadInspectorList();
            loadIncompleteInspections();
            showPage('dashboard'); // ê¸°ë³¸ í˜ì´ì§€ í‘œì‹œ
        };

        // í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜
        function showPage(pageName) {
            // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // ì„ íƒëœ í˜ì´ì§€ í‘œì‹œ
            const targetPage = document.getElementById(pageName + 'Page');
            if (targetPage) {
                targetPage.classList.add('active');
                
                // í˜ì´ì§€ë³„ ì´ˆê¸°í™” ì‘ì—…
                if (pageName === 'search') {
                    loadSearchPowderList();
                }
            }
        }
        
        // ë¶„ë§ ëª©ë¡ ë¡œë“œ
        function loadPowderList() {
            google.script.run
                .withSuccessHandler(function(powders) {
                    const powderSelect = document.getElementById('modalPowderSelect');
                    powderSelect.innerHTML = '<option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>';
                    
                    powders.forEach(powder => {
                        const option = new Option(powder, powder);
                        powderSelect.add(option);
                    });
                })
                .withFailureHandler(function(error) {
                    console.error('ë¶„ë§ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                })
                .getPowderList();
        }
        
        // ê²€ìƒ‰ìš© ë¶„ë§ ëª©ë¡ ë¡œë“œ
        function loadSearchPowderList() {
            google.script.run
                .withSuccessHandler(function(powders) {
                    const searchPowderSelect = document.getElementById('searchPowderSelect');
                    searchPowderSelect.innerHTML = '<option value="">ì „ì²´</option>';
                    
                    powders.forEach(powder => {
                        const option = new Option(powder, powder);
                        searchPowderSelect.add(option);
                    });
                })
                .withFailureHandler(function(error) {
                    console.error('ê²€ìƒ‰ ë¶„ë§ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                })
                .getPowderList();
        }
        
        // ë¯¸ì™„ë£Œ ê²€ì‚¬ ëª©ë¡ ë¡œë“œ
        function loadIncompleteInspections() {
            document.getElementById('loadingMessage').style.display = 'block';
            document.getElementById('incompleteInspections').style.display = 'none';
            document.getElementById('emptyMessage').style.display = 'none';
            
            google.script.run
                .withSuccessHandler(function(inspections) {
                    currentInspections = inspections;
                    displayIncompleteInspections(inspections);
                })
                .withFailureHandler(function(error) {
                    document.getElementById('loadingMessage').style.display = 'none';
                    document.getElementById('emptyMessage').innerHTML = 'ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    document.getElementById('emptyMessage').style.display = 'block';
                    console.error('ë¯¸ì™„ë£Œ ê²€ì‚¬ ë¡œë“œ ì‹¤íŒ¨:', error);
                })
                .getIncompleteInspections();
        }
        
        // ë¯¸ì™„ë£Œ ê²€ì‚¬ ëª©ë¡ í‘œì‹œ
        function displayIncompleteInspections(inspections) {
            document.getElementById('loadingMessage').style.display = 'none';
            
            if (inspections.length === 0) {
                document.getElementById('emptyMessage').style.display = 'block';
                return;
            }
            
            const tbody = document.getElementById('inspectionTableBody');
            tbody.innerHTML = '';
            
            inspections.forEach((inspection, index) => {
                const row = document.createElement('tr');
                row.onclick = () => continueInspection(index);
                
                const progressParts = inspection.progress.split('/');
                const completed = parseInt(progressParts[0]);
                const total = parseInt(progressParts[1]);
                const percentage = total > 0 ? (completed / total) * 100 : 0;
                
                row.innerHTML = `
                    <td>${inspection.powderName}</td>
                    <td>${inspection.lotNumber}</td>
                    <td>${inspection.inspectionType}</td>
                    <td>${inspection.inspector}</td>
                    <td>${new Date(inspection.startTime).toLocaleString()}</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%"></div>
                            <div class="progress-text">${inspection.progress}</div>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            document.getElementById('incompleteInspections').style.display = 'block';
        }

        // Inspector ëª©ë¡ ë¡œë“œ í•¨ìˆ˜ ì¶”ê°€
        function loadInspectorList() {
          google.script.run
            .withSuccessHandler(function(inspectors) {
              const inspectorSelect = document.getElementById('modalInspectorSelect');
              inspectorSelect.innerHTML = '<option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>';
              
              inspectors.forEach(inspector => {
                const option = new Option(inspector, inspector);
                inspectorSelect.add(option);
              });
            })
            .withFailureHandler(function(error) {
              console.error('ê²€ì‚¬ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            })
            .getInspectorList();
        }
        
        // ìƒˆ ê²€ì‚¬ ì‹œì‘ ëª¨ë‹¬ ì—´ê¸°
        function showNewInspectionModal() {
            document.getElementById('newInspectionModal').style.display = 'block';
        }
        
        // ìƒˆ ê²€ì‚¬ ì‹œì‘ ëª¨ë‹¬ ë‹«ê¸°
        function closeNewInspectionModal() {
            document.getElementById('newInspectionModal').style.display = 'none';
            // ì…ë ¥ê°’ ì´ˆê¸°í™”
            document.getElementById('modalPowderSelect').value = '';
            document.getElementById('modalLotNumber').value = '';
            document.getElementById('modalInspectorSelect').value = '';
            document.getElementById('modalDailyCheck').checked = true;
        }
        
        // ìƒˆ ê²€ì‚¬ ì‹œì‘ ì œì¶œ
        function submitNewInspection() {
            const powderName = document.getElementById('modalPowderSelect').value;
            const lotNumber = document.getElementById('modalLotNumber').value.trim();
            const inspector = document.getElementById('modalInspectorSelect').value;
            const inspectionType = document.querySelector('input[name="modalInspectionType"]:checked').value;
            
            if (!powderName) {
                alert('ë¶„ë§ëª…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!lotNumber) {
                alert('LOTë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!inspector) {
                alert('ê²€ì‚¬ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¡œë”© í‘œì‹œ
            const submitBtn = document.querySelector('.modal-btn.primary');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'ì²˜ë¦¬ì¤‘...';
            submitBtn.disabled = true;
            
            google.script.run
                .withSuccessHandler(function(result) {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    
                    if (result && result.success) {
                        closeNewInspectionModal();
                        startInspectionProcess(result);
                    } else {
                        alert(result ? result.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                })
                .withFailureHandler(function(error) {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    alert('ê²€ì‚¬ ì‹œì‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                })
                .startInspection(powderName, lotNumber, inspectionType, inspector);
        }
        
        // ê¸°ì¡´ ê²€ì‚¬ ì´ì–´ì„œ í•˜ê¸°
        function continueInspection(index) {
            const inspection = currentInspections[index];
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result && result.success) {
                        startInspectionProcess(result);
                    } else {
                        alert(result ? result.message : 'ê²€ì‚¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ê²€ì‚¬ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                })
                .startInspection(inspection.powderName, inspection.lotNumber, inspection.inspectionType, inspection.inspector);
        }
        
        // ê²€ì‚¬ í”„ë¡œì„¸ìŠ¤ ì‹œì‘
        function startInspectionProcess(result) {
            currentInspectionData = result.data;
            currentInspectionItems = result.items;
            completedItems = currentInspectionData.completedItems || [];

            // ê²€ì‚¬ ì •ë³´ í‘œì‹œ
            document.getElementById('inspectionPowderName').textContent = currentInspectionData.powderName;
            document.getElementById('inspectionLotNumber').textContent = currentInspectionData.lotNumber;
            document.getElementById('inspectionType').textContent = currentInspectionData.inspectionType;
            document.getElementById('inspectionInspector').textContent = currentInspectionData.inspector;

            // ë²„íŠ¼ì„ ê¸°ë³¸ ìƒíƒœë¡œ ë¦¬ì…‹ (ìƒˆ ê²€ì‚¬ ì‹œì‘ ëª¨ë“œ)
            const backBtn = document.getElementById('backToDashboardBtn');
            if (backBtn) {
                backBtn.textContent = 'ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°';
                backBtn.onclick = function() {
                    showPage('dashboard');
                };
            }

            // ê²€ì‚¬ í•­ëª© í‘œì‹œ
            displayInspectionItems();
            updateInspectionProgress();

            // ê²€ì‚¬ í˜ì´ì§€ë¡œ ì´ë™
            showPage('inspection');
        }
        
        // ê²€ì‚¬ í•­ëª© í‘œì‹œ
        function displayInspectionItems() {
            const container = document.getElementById('inspectionItems');
            container.innerHTML = '';
            
            currentInspectionItems.forEach(item => {
                const card = createInspectionCard(item);
                container.appendChild(card);
            });
        }
        
        // ê²€ì‚¬ ì¹´ë“œ ìƒì„±
        function createInspectionCard(item) {
            const isCompleted = completedItems.includes(item.name);
            
            const card = document.createElement('div');
            card.className = 'inspection-card';
            card.id = `card-${item.name}`;

            // ê²‰ë³´ê¸°ë°€ë„ ì „ìš© ì¹´ë“œ ìƒì„± ì¶”ê°€
            if (item.name === 'ApparentDensity') {
                return createApparentDensityCard(item, isCompleted);
            }

            // ìˆ˜ë¶„ë„ ì „ìš© ì¹´ë“œ ìƒì„±
            if (item.name === 'Moisture') {
                return createMoistureCard(item, isCompleted);
            }

            // íšŒë¶„ë„ ì „ìš© ì¹´ë“œ ìƒì„±
            if (item.name === 'Ash') {
                return createAshCard(item, isCompleted);
            }

            // ParticleSize ì „ìš© ì¹´ë“œ ìƒì„±
            if (item.isParticleSize) {
                return createParticleSizeCard(item, isCompleted);
            }
                     
            
            const specRange = (item.min !== '' && item.max !== '') ? 
                `${item.min} ~ ${item.max}` :
                (item.min !== '' ? `â‰¥ ${item.min}` : `â‰¤ ${item.max}`);
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="item-name">${item.displayName}</div>
                    <div class="spec-range">${specRange} ${item.unit}</div>
                </div>
                
                <div class="measurement-inputs">
                    <div class="input-group">
                        <label>1ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-1" 
                               oninput="calculateAverage('${item.name}')"
                               ${isCompleted ? 'disabled' : ''}>
                        <div class="unit">${item.unit}</div>
                    </div>
                    <div class="input-group">
                        <label>2ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-2" 
                               oninput="calculateAverage('${item.name}')"
                               ${isCompleted ? 'disabled' : ''}>
                        <div class="unit">${item.unit}</div>
                    </div>
                    <div class="input-group">
                        <label>3ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-3" 
                               oninput="calculateAverage('${item.name}')"
                               ${isCompleted ? 'disabled' : ''}>
                        <div class="unit">${item.unit}</div>
                    </div>
                </div>
                
                <div class="calculation-result">
                    <div class="avg-result">
                        <div>
                            <strong>í‰ê· ê°’: </strong>
                            <span class="avg-value" id="${item.name}-avg">-</span>
                            <span style="color: #666; font-size: 0.9em;">${item.unit}</span>
                        </div>
                        <div class="result-status pending" id="${item.name}-result">ëŒ€ê¸°ì¤‘</div>
                    </div>
                </div>
                
                <button class="save-btn ${isCompleted ? 'saved' : ''}" 
                        id="${item.name}-save" 
                        onclick="saveInspectionItem('${item.name}')"
                        ${isCompleted ? 'disabled' : ''}>
                    ${isCompleted ? 'ì €ì¥ì™„ë£Œ' : 'ì €ì¥'}
                </button>
            `;
            
            return card;
        }
        
        // ì…ë„ë¶„ì„ ì „ìš© ì¹´ë“œ ìƒì„±
        function createParticleSizeCard(item, isCompleted) {
            const card = document.createElement('div');
            card.className = 'inspection-card';
            card.id = `card-${item.name}`;
            
            let meshInputs = '';
            item.particleSpecs.forEach(spec => {
                let meshId = spec.meshSize.replace(' um', '').replace('+', '');
                if (meshId.startsWith('-')) {
                    meshId = meshId.replace('-', '') + 'M';
                }
                meshInputs += `
                    <div class="mesh-group">
                        <div class="mesh-header">
                            <span class="mesh-name">${spec.meshSize}</span>
                            <span class="mesh-spec">${spec.min} ~ ${spec.max} %</span>
                        </div>
                        <div class="input-group">
                            <label>1íšŒ:</label>
                            <input type="number" step="any" id="ParticleSize${meshId}-1" 
                                   oninput="calculateParticleSizeAverage('${meshId}')"
                                   ${isCompleted ? 'disabled' : ''}>
                            <div class="unit">%</div>
                        </div>
                        <div class="input-group">
                            <label>2íšŒ:</label>
                            <input type="number" step="any" id="ParticleSize${meshId}-2" 
                                   oninput="calculateParticleSizeAverage('${meshId}')"
                                   ${isCompleted ? 'disabled' : ''}>
                            <div class="unit">%</div>
                        </div>
                        <div class="mesh-result">
                            <span>í‰ê· : <span id="ParticleSize${meshId}-avg">-</span>%</span>
                            <span class="result-status pending" id="ParticleSize${meshId}-result">ëŒ€ê¸°ì¤‘</span>
                        </div>
                    </div>
                `;
            });
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="item-name">${item.displayName}</div>
                </div>
                
                <div class="particle-size-inputs">
                    ${meshInputs}
                </div>
                
                <div class="calculation-result">
                    <div class="avg-result">
                        <div><strong>ì „ì²´ ê²°ê³¼:</strong></div>
                        <div class="result-status pending" id="ParticleSize-result">ëŒ€ê¸°ì¤‘</div>
                    </div>
                </div>
                
                <button class="save-btn ${isCompleted ? 'saved' : ''}" 
                        id="ParticleSize-save" 
                        onclick="saveInspectionItem('ParticleSize')"
                        ${isCompleted ? 'disabled' : ''}>
                    ${isCompleted ? 'ì €ì¥ì™„ë£Œ' : 'ì €ì¥'}
                </button>
            `;
            
            return card;
        }


        // í‰ê·  ê³„ì‚° ë° í•©ê²©/ë¶ˆí•©ê²© íŒì •
        // í•­ëª©ë³„ ì†Œìˆ˜ì  ìë¦¿ìˆ˜ ë°˜í™˜
        function getDecimalPlaces(itemName) {
            const decimalPlacesMap = {
                'FlowRate': 2,
                'ApparentDensity': 2,
                'CContent': 2,
                'CuContent': 2,
                'Moisture': 2,
                'Ash': 2,
                'SinterChangeRate': 2,
                'SinterStrength': 1,
                'FormingStrength': 1,
                'FormingLoad': 1,
                'ParticleSize': 1
            };
            return decimalPlacesMap[itemName] || 2; // ê¸°ë³¸ê°’ 2ìë¦¬
        }

        function calculateAverage(itemName) {
            const val1 = parseFloat(document.getElementById(itemName + '-1').value) || null;
            const val2 = parseFloat(document.getElementById(itemName + '-2').value) || null;
            const val3 = parseFloat(document.getElementById(itemName + '-3').value) || null;

            const values = [val1, val2, val3].filter(v => v !== null);

            if (values.length === 0) {
                document.getElementById(itemName + '-avg').textContent = '-';
                document.getElementById(itemName + '-result').textContent = 'ëŒ€ê¸°ì¤‘';
                document.getElementById(itemName + '-result').className = 'result-status pending';
                return;
            }

            const average = values.reduce((sum, val) => sum + val, 0) / values.length;
            const decimalPlaces = getDecimalPlaces(itemName);
            document.getElementById(itemName + '-avg').textContent = average.toFixed(decimalPlaces);

            // í•©ê²©/ë¶ˆí•©ê²© íŒì •
            const item = currentInspectionItems.find(item => item.name === itemName);
            let result = 'PASS';

            if (item.min !== '' && average < parseFloat(item.min)) {
                result = 'FAIL';
            }
            if (item.max !== '' && average > parseFloat(item.max)) {
                result = 'FAIL';
            }

            const resultElement = document.getElementById(itemName + '-result');
            if (result === 'PASS') {
                resultElement.textContent = 'í•©ê²©';
                resultElement.className = 'result-status pass';
            } else {
                resultElement.textContent = 'ë¶ˆí•©ê²©';
                resultElement.className = 'result-status fail';
            }
        }
        
        // ì…ë„ë¶„ì„ ê°œë³„ MESH í‰ê·  ê³„ì‚°
        function calculateParticleSizeAverage(meshId) {
            const val1 = parseFloat(document.getElementById(`ParticleSize${meshId}-1`).value) || null;
            const val2 = parseFloat(document.getElementById(`ParticleSize${meshId}-2`).value) || null;

            const values = [val1, val2].filter(v => v !== null);

            if (values.length === 0) {
                document.getElementById(`ParticleSize${meshId}-avg`).textContent = '-';
                document.getElementById(`ParticleSize${meshId}-result`).textContent = 'ëŒ€ê¸°ì¤‘';
                document.getElementById(`ParticleSize${meshId}-result`).className = 'result-status pending';
                updateParticleSizeOverallResult();
                return;
            }

            const average = values.reduce((sum, val) => sum + val, 0) / values.length;
            document.getElementById(`ParticleSize${meshId}-avg`).textContent = average.toFixed(1);

            // í•©ê²©/ë¶ˆí•©ê²© íŒì • (ë³„ë„ í•¨ìˆ˜ì—ì„œ ì²˜ë¦¬)
            checkParticleSizeMeshResult(meshId, average);
            updateParticleSizeOverallResult();
        }
        
        // ê°œë³„ MESH í•©ê²©/ë¶ˆí•©ê²© íŒì •
        function checkParticleSizeMeshResult(meshId, average) {
            // ParticleSize í•­ëª©ì—ì„œ í•´ë‹¹ MESHì˜ ê·œê²© ì°¾ê¸°
            const particleItem = currentInspectionItems.find(item => item.name === 'ParticleSize');
            if (!particleItem || !particleItem.particleSpecs) return;
            
            const meshName = meshId.includes('M') ? `-${meshId.replace('M', '')} um` : `+${meshId} um`;
            const meshSpec = particleItem.particleSpecs.find(spec => spec.meshSize === meshName);
            
            if (!meshSpec) return;
            
            let result = 'PASS';
            if (average < parseFloat(meshSpec.min) || average > parseFloat(meshSpec.max)) {
                result = 'FAIL';
            }
            
            const resultElement = document.getElementById(`ParticleSize${meshId}-result`);
            if (result === 'PASS') {
                resultElement.textContent = 'í•©ê²©';
                resultElement.className = 'result-status pass';
            } else {
                resultElement.textContent = 'ë¶ˆí•©ê²©';
                resultElement.className = 'result-status fail';
            }
        }
        
        // ì…ë„ë¶„ì„ ì „ì²´ ê²°ê³¼ ì—…ë°ì´íŠ¸
        function updateParticleSizeOverallResult() {
            const meshIds = ['180', '150', '106', '75', '45', '45M'];
            let hasResults = false;
            let overallResult = 'PASS';
            
            meshIds.forEach(meshId => {
                const resultElement = document.getElementById(`ParticleSize${meshId}-result`);
                if (resultElement && resultElement.textContent !== 'ëŒ€ê¸°ì¤‘') {
                    hasResults = true;
                    if (resultElement.textContent === 'ë¶ˆí•©ê²©') {
                        overallResult = 'FAIL';
                    }
                }
            });
            
            const overallResultElement = document.getElementById('ParticleSize-result');
            if (!hasResults) {
                overallResultElement.textContent = 'ëŒ€ê¸°ì¤‘';
                overallResultElement.className = 'result-status pending';
            } else {
                if (overallResult === 'PASS') {
                    overallResultElement.textContent = 'í•©ê²©';
                    overallResultElement.className = 'result-status pass';
                } else {
                    overallResultElement.textContent = 'ë¶ˆí•©ê²©';
                    overallResultElement.className = 'result-status fail';
                }
            }
        }

        // ê²‰ë³´ê¸°ë°€ë„ ê³„ì‚° í•¨ìˆ˜
        function calculateApparentDensity(itemName) {
            const apparentDensities = [];

            // 1ì°¨, 2ì°¨, 3ì°¨ ê°ê° ê³„ì‚°
            for (let i = 1; i <= 3; i++) {
                const emptyCupWeight = parseFloat(document.getElementById(itemName + '-emptyCup' + i).value) || null;
                const powderWeight = parseFloat(document.getElementById(itemName + '-powderWeight' + i).value) || null;

                if (emptyCupWeight !== null && powderWeight !== null) {
                    const apparentDensity = (powderWeight - emptyCupWeight) / 25;
                    apparentDensities.push(apparentDensity);
                    document.getElementById(itemName + '-calculated' + i).textContent = apparentDensity.toFixed(2);
                } else {
                    document.getElementById(itemName + '-calculated' + i).textContent = '-';
                }
            }

            // í‰ê·  ê³„ì‚°
            if (apparentDensities.length === 0) {
                document.getElementById(itemName + '-avg').textContent = '-';
                document.getElementById(itemName + '-result').textContent = 'ëŒ€ê¸°ì¤‘';
                document.getElementById(itemName + '-result').className = 'result-status pending';
                return;
            }

            const average = apparentDensities.reduce((sum, val) => sum + val, 0) / apparentDensities.length;
            document.getElementById(itemName + '-avg').textContent = average.toFixed(2);

            // í•©ê²©/ë¶ˆí•©ê²© íŒì •
            const item = currentInspectionItems.find(item => item.name === itemName);
            let result = 'PASS';

            if (item.min !== '' && average < parseFloat(item.min)) {
                result = 'FAIL';
            }
            if (item.max !== '' && average > parseFloat(item.max)) {
                result = 'FAIL';
            }

            const resultElement = document.getElementById(itemName + '-result');
            if (result === 'PASS') {
                resultElement.textContent = 'í•©ê²©';
                resultElement.className = 'result-status pass';
            } else {
                resultElement.textContent = 'ë¶ˆí•©ê²©';
                resultElement.className = 'result-status fail';
            }
        }

        // ê²€ì‚¬ í•­ëª© ì €ì¥
        function saveInspectionItem(itemName) {
          
            // ParticleSize ì „ìš© ì €ì¥ ì²˜ë¦¬
            if (itemName === 'ParticleSize') {
                saveParticleSizeItem();
                return;
            }

            // ê²‰ë³´ê¸°ë°€ë„ ì „ìš© ì €ì¥ ì²˜ë¦¬ ì¶”ê°€
            if (itemName === 'ApparentDensity') {
                saveApparentDensityItemClient();
                return;
            }

            // ìˆ˜ë¶„ë„ ì „ìš© ì €ì¥ ì²˜ë¦¬ ì¶”ê°€
            if (itemName === 'Moisture') {
                saveMoistureItemClient();
                return;
            }

            // íšŒë¶„ë„ ì „ìš© ì €ì¥ ì²˜ë¦¬ ì¶”ê°€
            if (itemName === 'Ash') {
                saveAshItemClient();
                return;
            }

            const val1 = document.getElementById(itemName + '-1').value;
            const val2 = document.getElementById(itemName + '-2').value;
            const val3 = document.getElementById(itemName + '-3').value;
            
            const values = [val1, val2, val3];
            const validValues = values.filter(v => v !== '' && !isNaN(v));
            
            if (validValues.length === 0) {
                alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì¸¡ì •ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© ìƒíƒœ
            const saveBtn = document.getElementById(itemName + '-save');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'ì €ì¥ì¤‘...';
            saveBtn.disabled = true;
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result && result.success) {
                        // ì €ì¥ ì„±ê³µ
                        saveBtn.textContent = 'ì €ì¥ì™„ë£Œ';
                        saveBtn.className = 'save-btn saved';
                        
                        // ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
                        document.getElementById(itemName + '-1').disabled = true;
                        document.getElementById(itemName + '-2').disabled = true;
                        document.getElementById(itemName + '-3').disabled = true;
                        
                        // ì™„ë£Œëœ í•­ëª©ì— ì¶”ê°€
                        if (!completedItems.includes(itemName)) {
                            completedItems.push(itemName);
                        }
                        
                        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
                        updateInspectionProgress();
                        
                        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        
                        // ëª¨ë“  í•­ëª© ì™„ë£Œ ì‹œ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ ì œì•ˆ
                        if (completedItems.length === currentInspectionItems.length) {
                            if (confirm('ëª¨ë“  ê²€ì‚¬ í•­ëª©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                showPage('dashboard');
                                loadInspectionItems(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                            }
                        }
                    } else {
                        alert(result ? result.message : 'ì €ì¥ ì‹¤íŒ¨');
                        saveBtn.textContent = originalText;
                        saveBtn.disabled = false;
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                    saveBtn.textContent = originalText;
                    saveBtn.disabled = false;
                })
                .saveInspectionItem(
                    currentInspectionData.powderName,
                    currentInspectionData.lotNumber,
                    itemName,
                    values
                );
        }
        
        // ê²€ì‚¬ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateInspectionProgress() {
            const totalItems = currentInspectionItems.length;
            const completed = completedItems.length;
            const percentage = totalItems > 0 ? (completed / totalItems) * 100 : 0;
            
            document.getElementById('inspectionProgressFill').style.width = percentage + '%';
            document.getElementById('inspectionProgressText').textContent = `${completed}/${totalItems}`;
        }
        
        // ê²€ì‚¬ ê²°ê³¼ ì¡°íšŒ ì‹¤í–‰
        function executeSearch() {
            const powderName = document.getElementById('searchPowderSelect').value;
            const lotNumber = document.getElementById('searchLotNumber').value.trim();
            const startDate = document.getElementById('searchStartDate').value;
            const endDate = document.getElementById('searchEndDate').value;
            
            // UI ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('searchLoadingMessage').style.display = 'block';
            document.getElementById('searchEmptyResults').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
            
            google.script.run
                .withSuccessHandler(function(result) {
                    document.getElementById('searchLoadingMessage').style.display = 'none';
                    
                    if (result && result.success) {
                        searchResults = result.data;
                        displaySearchResults(result.data);
                    } else {
                        alert(result ? result.message : 'ì¡°íšŒ ì‹¤íŒ¨');
                        document.getElementById('searchEmptyResults').style.display = 'block';
                    }
                })
                .withFailureHandler(function(error) {
                    document.getElementById('searchLoadingMessage').style.display = 'none';
                    document.getElementById('searchEmptyResults').style.display = 'block';
                    console.error('ê²€ìƒ‰ ì‹¤íŒ¨:', error);
                })
                .searchInspectionResults(
                    powderName || null,
                    lotNumber || null,
                    startDate || null,
                    endDate || null
                );
        }
        
        // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
        function displaySearchResults(results) {
            if (results.length === 0) {
                document.getElementById('searchEmptyResults').style.display = 'block';
                document.getElementById('searchResultsCount').textContent = 'ì¡°íšŒëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤';
                return;
            }
            
            // ê²°ê³¼ ìˆ˜ í‘œì‹œ
            document.getElementById('searchResultsCount').textContent = `ì´ ${results.length}ê±´ì˜ ê²°ê³¼`;
            
            // í…Œì´ë¸” í—¤ë” ìƒì„±
            createSearchTableHeader(results[0]);
            
            // í…Œì´ë¸” ë°”ë”” ìƒì„±
            createSearchTableBody(results);
            
            // í…Œì´ë¸” í‘œì‹œ
            document.getElementById('searchResults').style.display = 'block';
        }
        
        // ê²€ìƒ‰ ê²°ê³¼ í…Œì´ë¸” í—¤ë” ìƒì„±
        function createSearchTableHeader(sampleResult) {
            const header = document.getElementById('searchTableHeader');
            header.innerHTML = '';
            
            // ì§€ì •ëœ ìˆœì„œë¡œ ì»¬ëŸ¼ ìƒì„±
            const orderedColumns = [
                'InspectionTime', 'InspectionType', 'PowderName', 'LotNumber', 'Inspector',
                'Actions',
                'FinalResult', 'ApparentDensityResult', 'FlowRateResult', 'CContentResult',
                'CuContentResult', 'MoistureResult', 'AshResult', 'ParticleSizeResult',
                'FormingLoadResult', 'FormingStrengthResult', 'SinterChangeRateResult',
                'SinterStrengthResult'
            ];
            
            orderedColumns.forEach(column => {
                const th = document.createElement('th');
                th.textContent = getColumnDisplayName(column);
                
                // í—¤ë”ì—ë„ ë™ì¼í•œ í´ë˜ìŠ¤ ì ìš©
                if (['InspectionTime', 'InspectionType', 'PowderName', 'LotNumber', 'Inspector'].includes(column)) {
                    th.className = 'basic-info-cell';
                } else if (column === 'Actions') {  
                    th.className = 'action-cell';
                } else if (column === 'FinalResult') {
                    th.className = 'final-result-cell';
                } else {
                    th.className = 'result-column';
                }
                
                header.appendChild(th);
            });
        }

        // ë‚ ì§œë§Œ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ (ë…„/ì›”/ì¼)
        function formatDateOnly(dateValue) {
            if (!dateValue) return '-';
            try {
                const date = new Date(dateValue);
                return date.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
            } catch (error) {
                return dateValue;
            }
        }

        // ì‘ì—… ë²„íŠ¼ ì…€ ìƒì„± í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function createActionButtonsCell(powderName, lotNumber) {
            const cell = document.createElement('td');
            cell.className = 'action-buttons';
            
            // ì¡°íšŒ ë²„íŠ¼
            const viewBtn = document.createElement('button');
            viewBtn.className = 'action-btn view-btn';
            viewBtn.textContent = 'ì¡°íšŒ';
            viewBtn.onclick = function(e) {
                e.stopPropagation();
                loadInspectionDetail(powderName, lotNumber);
            };
            
            // ìˆ˜ì • ë²„íŠ¼
            const editBtn = document.createElement('button');
            editBtn.className = 'action-btn edit-btn';
            editBtn.textContent = 'ìˆ˜ì •';
            editBtn.onclick = function(e) {
                e.stopPropagation();
                editInspection(powderName, lotNumber);
            };
            
            // ì‚­ì œ ë²„íŠ¼
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'action-btn delete-btn';
            deleteBtn.textContent = 'ì‚­ì œ';
            deleteBtn.onclick = function(e) {
                e.stopPropagation();
                deleteInspection(powderName, lotNumber);
            };
            
            cell.appendChild(viewBtn);
            cell.appendChild(editBtn);
            cell.appendChild(deleteBtn);
            
            return cell;
        }

        // ê²€ì‚¬ ìƒì„¸ ì¡°íšŒ í•¨ìˆ˜ (ì¡°íšŒ ë²„íŠ¼ìš©)
        function loadInspectionDetail(powderName, lotNumber) {
            console.log('ê²€ì‚¬ ìƒì„¸ ì¡°íšŒ:', powderName, lotNumber);
            
            // ê²€ì‚¬ ìƒì„¸ ë°ì´í„° ì¡°íšŒ
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result && result.success) {
                        displayInspectionDetail(result.data);
                    } else {
                        alert('ê²€ì‚¬ ìƒì„¸ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ê²€ì‚¬ ìƒì„¸ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                })
                .getInspectionDetail(powderName, lotNumber);
        }

        // ê²€ìƒ‰ ê²°ê³¼ í…Œì´ë¸” ë°”ë”” ìƒì„±
        function createSearchTableBody(results) {
            const tbody = document.getElementById('searchTableBody');
            tbody.innerHTML = '';
            
            results.forEach(result => {
                const row = document.createElement('tr');
                
                // ì§€ì •ëœ ìˆœì„œë¡œ ë°ì´í„° ì¶”ê°€
                const orderedColumns = [
                    'InspectionTime', 'InspectionType', 'PowderName', 'LotNumber', 'Inspector',
                    'Actions',
                    'FinalResult', 'ApparentDensityResult', 'FlowRateResult', 'CContentResult',
                    'CuContentResult', 'MoistureResult', 'AshResult', 'ParticleSizeResult',
                    'FormingLoadResult', 'FormingStrengthResult', 'SinterChangeRateResult',
                    'SinterStrengthResult'
                ];
                
                orderedColumns.forEach(column => {
                    if (column === 'Actions') {
                        const actionCell = createActionButtonsCell(result.PowderName, result.LotNumber);
                        actionCell.className = 'action-cell';
                        row.appendChild(actionCell);
                    } else if (column === 'ParticleSizeResult') {
                        // ì…ë„ë¶„ì„ ê²°ê³¼ í†µí•© ì²˜ë¦¬
                        const particleSizeCell = createParticleSizeResultCell(result);
                        particleSizeCell.className = 'result-column';
                        row.appendChild(particleSizeCell);
                    } else if (column === 'InspectionTime') {
                        // ê²€ì‚¬ì‹œê°„ - ë…„/ì›”/ì¼ë§Œ í‘œì‹œ
                        const timeCell = createSearchCell(formatDateOnly(result[column]));
                        timeCell.className = 'basic-info-cell inspection-time-cell';
                        row.appendChild(timeCell);
                    } else if (column === 'InspectionType') {
                        // ê²€ì‚¬íƒ€ì…
                        const cell = createSearchCell(result[column] || '-');
                        cell.className = 'basic-info-cell';
                        row.appendChild(cell);
                    } else if (['PowderName', 'LotNumber', 'Inspector'].includes(column)) {
                        // ë¶„ë§ëª…, LOTë²ˆí˜¸, ê²€ì‚¬ì - í•œì¤„ í‘œì‹œ
                        const cell = createSearchCell(result[column] || '-');
                        cell.className = 'basic-info-cell info-cell';
                        row.appendChild(cell);
                    } else {
                        // ê²€ì‚¬ ê²°ê³¼ (ìµœì¢…ê²°ê³¼ í¬í•¨)
                        const cell = createSearchResultCell(result[column], column);
                        if (column === 'FinalResult') {
                            cell.className = 'final-result-cell';
                        } else {
                            cell.className = 'result-column';
                        }
                        row.appendChild(cell);
                    }
                });
                
                tbody.appendChild(row);
            });
        }

        // ì…ë„ë¶„ì„ ê²°ê³¼ í†µí•© í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function createParticleSizeResultCell(result) {
            const cell = document.createElement('td');
            
            // ì…ë„ë¶„ì„ ê´€ë ¨ ì»¬ëŸ¼ë“¤ í™•ì¸
            const particleSizeColumns = [
                'ParticleSize180Result', 'ParticleSize150Result', 'ParticleSize106Result',
                'ParticleSize75Result', 'ParticleSize45Result', 'ParticleSize45MResult'
            ];
            
            let allPass = true;
            let hasData = false;
            
            particleSizeColumns.forEach(column => {
                if (result[column]) {
                    hasData = true;
                    if (result[column] !== 'PASS') {
                        allPass = false;
                    }
                }
            });
            
            if (!hasData) {
                cell.textContent = '-';
            } else {
                const span = document.createElement('span');
                span.className = `result-status ${allPass ? 'pass' : 'fail'}`;
                span.textContent = allPass ? 'OK' : 'NG';
                span.style.fontSize = '0.8em';
                span.style.padding = '4px 8px';
                cell.appendChild(span);
            }
            
            return cell;
        }
        
        // ê²€ìƒ‰ ê²°ê³¼ ì…€ ìƒì„±
        function createSearchCell(content) {
            const cell = document.createElement('td');
            cell.textContent = content || '-';
            return cell;
        }
        
        // ê²€ì‚¬ ê²°ê³¼ ì…€ ìƒì„± (ìˆ˜ì •ëœ ë²„ì „)
        function createSearchResultCell(result, columnName = '') {
            const cell = document.createElement('td');

            if (result === 'PASS' || result === 'FAIL') {
                const span = document.createElement('span');
                span.className = `result-status ${result.toLowerCase()}`;
                span.textContent = result === 'PASS' ? 'OK' : 'NG';
                span.style.fontSize = '0.8em';
                span.style.padding = '4px 8px';

                cell.appendChild(span);
            } else {
                cell.textContent = '-';
            }
            return cell;
        }
        
        // ì»¬ëŸ¼ í‘œì‹œëª… ë³€í™˜
        function getColumnDisplayName(columnKey) {
            const displayNames = {
                'InspectionTime': 'ê²€ì‚¬ì‹œê°„',
                'InspectionType': 'ê²€ì‚¬íƒ€ì…',
                'PowderName': 'ë¶„ë§ëª…',
                'LotNumber': 'LOTë²ˆí˜¸',
                'Inspector': 'ê²€ì‚¬ì',
                'Actions': 'ì‘ì—…',
                'FinalResult': 'ìµœì¢…ê²°ê³¼',
                'ApparentDensityResult': 'ê²‰ë³´ê¸°ë°€ë„',
                'FlowRateResult': 'ìœ ë™ë„',
                'CContentResult': 'Cí•¨ëŸ‰',
                'CuContentResult': 'Cuí•¨ëŸ‰',
                'MoistureResult': 'ìˆ˜ë¶„ë„',
                'AshResult': 'íšŒë¶„ë„',
                'ParticleSizeResult': 'ì…ë„',
                'FormingLoadResult': 'ì„±í˜•í•˜ì¤‘',
                'FormingStrengthResult': 'ì„±í˜•ê°•ë„',
                'SinterChangeRateResult': 'ì†Œê²°ë³€í™”ìœ¨',
                'SinterStrengthResult': 'ì†Œê²°ê°•ë„'
            };
            
            return displayNames[columnKey] || columnKey;
        }
        
        // ë‚ ì§œ í¬ë§·
        function formatDate(dateValue) {
            if (!dateValue) return '-';
            try {
                const date = new Date(dateValue);
                return date.toLocaleString('ko-KR');
            } catch (error) {
                return dateValue;
            }
        }
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('newInspectionModal');
            if (event.target === modal) {
                closeNewInspectionModal();
            }
        };
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (ESCë¡œ ëª¨ë‹¬ ë‹«ê¸°)
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeNewInspectionModal();
            }
        });

        // ë°”ì½”ë“œ ìŠ¤ìº” ì‹œì‘
        function startBarcodeScanning() {
            document.getElementById('barcodeScanner').style.display = 'block';
            initializeBarcodeScanner();
        }

        // ë°”ì½”ë“œ ìŠ¤ìºë„ˆ ì´ˆê¸°í™”
        function initializeBarcodeScanner() {
            // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
            if (typeof Quagga !== 'undefined') {
                Quagga.offDetected();
                Quagga.offProcessed();
            }
            
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scannerArea')
                },
                decoder: {
                    readers: ["code_128_reader", "code_39_reader", "ean_reader", "ean_8_reader"]
                }
            }, function(err) {
                if (err) {
                    console.error('ë°”ì½”ë“œ ìŠ¤ìºë„ˆ ì´ˆê¸°í™” ì‹¤íŒ¨:', err);
                    alert('ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                    return;
                }
                console.log('ë°”ì½”ë“œ ìŠ¤ìºë„ˆê°€ ì„±ê³µì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                Quagga.start();
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                Quagga.onDetected(function(data) {
                    const barcode = data.codeResult.code;
                    console.log('ë°”ì½”ë“œ ê°ì§€ë¨:', barcode);
                    handleBarcodeDetected(barcode);
                });
            });
        }

        // ë°”ì½”ë“œ ê°ì§€ ì²˜ë¦¬ (ì¤‘ë³µ ë°©ì§€)
        let isProcessingBarcode = false;

        function handleBarcodeDetected(barcode) {
            if (isProcessingBarcode) return; // ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
            
            isProcessingBarcode = true;
            Quagga.stop();
            closeBarcodeScanner();
            
            console.log('ìŠ¤ìº”ëœ ë°”ì½”ë“œ:', barcode);
            
            // ë°”ì½”ë“œ ë°ì´í„° íŒŒì‹±
            const barcodeData = parseBarcodeData(barcode);
            console.log('íŒŒì‹±ëœ ë°ì´í„°:', barcodeData);
            
            if (!barcodeData.lotNumber) {
                alert('ì˜¬ë°”ë¥¸ ë°”ì½”ë“œ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                resetBarcodeScanning();
                return;
            }
            
            // ìŠ¤ìº” ê²°ê³¼ í™•ì¸ íŒì—…
            showBarcodeConfirmation(barcodeData);
        }

        // ë°”ì½”ë“œ ìŠ¤ìº” ê²°ê³¼ í™•ì¸
        function showBarcodeConfirmation(barcodeData) {
            const message = 'ìŠ¤ìº”ëœ ì •ë³´ê°€ ë§ìŠµë‹ˆê¹Œ?\n\n' +
                          'ë¶„ë§ëª…: ' + barcodeData.powderName + '\n' +
                          'LOTë²ˆí˜¸: ' + barcodeData.lotNumber + '\n\n' +
                          'í™•ì¸ì„ ëˆ„ë¥´ë©´ ê³„ì† ì§„í–‰ë©ë‹ˆë‹¤.';
            
            if (confirm(message)) {
                // í™•ì¸ ì„ íƒ ì‹œ ê¸°ì¡´ ê²€ì‚¬ ë°ì´í„° í™•ì¸
                checkExistingInspection(barcodeData.powderName, barcodeData.lotNumber);
            } else {
                // ì·¨ì†Œ ì„ íƒ ì‹œ ì¬ìŠ¤ìº” ë˜ëŠ” ìˆ˜ë™ì…ë ¥ ì„ íƒ
                showRescanOptions();
            }
        }

        // ì¬ìŠ¤ìº” ë˜ëŠ” ìˆ˜ë™ì…ë ¥ ì„ íƒ
        function showRescanOptions() {
            if (confirm('ë‹¤ì‹œ ìŠ¤ìº”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní™•ì¸: ì¬ìŠ¤ìº”\nì·¨ì†Œ: ìˆ˜ë™ì…ë ¥')) {
                // ì¬ìŠ¤ìº” ì„ íƒ
                resetBarcodeScanning();
                startBarcodeScanning();
            } else {
                // ìˆ˜ë™ì…ë ¥ ì„ íƒ
                resetBarcodeScanning();
                showNewInspectionModal();
            }
        }

        // ë°”ì½”ë“œ ìŠ¤ìº” ìƒíƒœ ì´ˆê¸°í™”
        function resetBarcodeScanning() {
            isProcessingBarcode = false;
        }
        
        // ê¸°ì¡´ ê²€ì‚¬ ë°ì´í„° í™•ì¸
        function checkExistingInspection(powderName, lotNumber) {
            console.log('ê²€ì‚¬ ë°ì´í„° í™•ì¸ ì¤‘:', powderName, lotNumber);
            
            google.script.run
                .withSuccessHandler(function(result) {
                    handleInspectionCheckResult(result, powderName, lotNumber);
                })
                .withFailureHandler(function(error) {
                    console.error('ê²€ì‚¬ í™•ì¸ ì‹¤íŒ¨:', error);
                    alert('ê²€ì‚¬ ë°ì´í„° í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                })
                .getExistingInspection(powderName, lotNumber);
        }
        
        // ê²€ì‚¬ í™•ì¸ ê²°ê³¼ ì²˜ë¦¬
        function handleInspectionCheckResult(existingInspection, powderName, lotNumber) {
            if (existingInspection) {
                // ë¯¸ì™„ë£Œ ê²€ì‚¬ê°€ ìˆëŠ” ê²½ìš°
                if (confirm('ë¯¸ì™„ë£Œëœ ê²€ì‚¬ê°€ ìˆìŠµë‹ˆë‹¤.\nê²€ì‚¬ë¥¼ ê³„ì† ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    startInspectionFromExisting(powderName, lotNumber);
                } else {
                    resetBarcodeScanning();
                }
            } else {
                // ì™„ë£Œëœ ê²€ì‚¬ í™•ì¸
                checkCompletedInspection(powderName, lotNumber);
            }
        }
        
        // ì™„ë£Œëœ ê²€ì‚¬ í™•ì¸
        function checkCompletedInspection(powderName, lotNumber) {
            const searchPowderName = powderName || null;
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result && result.success && result.data && result.data.length > 0) {
                        showCompletedInspectionResult(result.data[0]);
                    } else {
                        startNewInspectionFromBarcode(powderName, lotNumber);
                    }
                })
                .withFailureHandler(function(error) {
                    console.error('ì™„ë£Œëœ ê²€ì‚¬ í™•ì¸ ì‹¤íŒ¨:', error);
                    startNewInspectionFromBarcode(powderName, lotNumber);
                })
                .searchInspectionResults(searchPowderName, lotNumber, null, null);
        }
        
        // ì™„ë£Œëœ ê²€ì‚¬ ê²°ê³¼ í‘œì‹œ
        function showCompletedInspectionResult(inspectionData) {
            alert('ê²€ì‚¬ ì™„ë£Œ ê²°ê³¼:\në¶„ë§ëª…: ' + inspectionData.PowderName + 
                  '\nLOTë²ˆí˜¸: ' + inspectionData.LotNumber + 
                  '\nìµœì¢…ê²°ê³¼: ' + (inspectionData.FinalResult === 'PASS' ? 'OK' : 'NG'));
            // ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ìƒì„¸ ê²°ê³¼ í™”ë©´ êµ¬í˜„ ì˜ˆì •
        }

        // ë°”ì½”ë“œ ìŠ¤ìºë„ˆ ë‹«ê¸°
        function closeBarcodeScanner() {
            if (typeof Quagga !== 'undefined') {
                Quagga.stop();
                Quagga.offDetected(); // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                Quagga.offProcessed(); // ì²˜ë¦¬ ì´ë²¤íŠ¸ ì œê±°
            }
            document.getElementById('barcodeScanner').style.display = 'none';
            isProcessingBarcode = false; // ì²˜ë¦¬ ìƒíƒœ ì´ˆê¸°í™”
            console.log('ë°”ì½”ë“œ ìŠ¤ìºë„ˆê°€ ì™„ì „íˆ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ë°”ì½”ë“œ ë°ì´í„° íŒŒì‹± (í˜•ì‹: "ABC-100-254848")
        function parseBarcodeData(barcode) {
            let powderName = '';
            let lotNumber = '';
            
            // ë§ˆì§€ë§‰ í•˜ì´í”ˆì„ ê¸°ì¤€ìœ¼ë¡œ ë¶„í• 
            const lastDashIndex = barcode.lastIndexOf('-');
            
            if (lastDashIndex !== -1) {
                powderName = barcode.substring(0, lastDashIndex);
                lotNumber = barcode.substring(lastDashIndex + 1);
            } else {
                // í•˜ì´í”ˆì´ ì—†ìœ¼ë©´ ì „ì²´ë¥¼ LOTë²ˆí˜¸ë¡œ ì²˜ë¦¬
                lotNumber = barcode;
            }
            
            return {
                powderName: powderName.trim(),
                lotNumber: lotNumber.trim(),
                originalBarcode: barcode
            };
        }

        // ìˆ˜ë™ ì…ë ¥ìœ¼ë¡œ ì „í™˜
        function showManualInput() {
            closeBarcodeScanner();
            showNewInspectionModal();
        }

        // ê¸°ì¡´ ê²€ì‚¬ ì´ì–´ì„œ í•˜ê¸° (ë°”ì½”ë“œì—ì„œ)
        function startInspectionFromExisting(powderName, lotNumber) {
            // 1ë‹¨ê³„: ê¸°ì¡´ ê²€ì‚¬ ì •ë³´ ë¨¼ì € ê°€ì ¸ì˜¤ê¸°
            google.script.run
                .withSuccessHandler(function(existingData) {
                    if (existingData) {
                        // 2ë‹¨ê³„: ê¸°ì¡´ ê²€ì‚¬ ì •ë³´ë¡œ startInspection í˜¸ì¶œ
                        google.script.run
                            .withSuccessHandler(function(result) {
                                if (result && result.success) {
                                    startInspectionProcess(result);
                                } else {
                                    alert('ê²€ì‚¬ ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result ? result.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                                }
                                resetBarcodeScanning();
                            })
                            .withFailureHandler(function(error) {
                                alert('ê²€ì‚¬ ì‹œì‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                                resetBarcodeScanning();
                            })
                            .startInspection(powderName, lotNumber, existingData.inspectionType, existingData.inspector);
                    } else {
                        alert('ê¸°ì¡´ ê²€ì‚¬ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        resetBarcodeScanning();
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ê¸°ì¡´ ê²€ì‚¬ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                    resetBarcodeScanning();
                })
                .getExistingInspection(powderName, lotNumber);
        }

        // ìƒˆ ê²€ì‚¬ ì‹œì‘ (ë°”ì½”ë“œì—ì„œ)
        function startNewInspectionFromBarcode(powderName, lotNumber) {
            // ìƒˆ ê²€ì‚¬ ì‹œì‘ ëª¨ë‹¬ì„ ì—´ê³  ë¶„ë§ëª…/LOTë²ˆí˜¸ ìë™ ì…ë ¥
            showNewInspectionModal();
            
            // ì§§ì€ ì§€ì—° í›„ ê°’ ì„¤ì • (DOM ì—…ë°ì´íŠ¸ ëŒ€ê¸°)
            setTimeout(function() {
                if (powderName) {
                    document.getElementById('modalPowderSelect').value = powderName;
                }
                document.getElementById('modalLotNumber').value = lotNumber;
                
                // í¬ì»¤ìŠ¤ë¥¼ ê²€ì‚¬ì ì„ íƒë€ìœ¼ë¡œ ì´ë™
                document.getElementById('modalInspectorSelect').focus();
            }, 100);
            
            resetBarcodeScanning();
        }

        // ì™„ë£Œëœ ê²€ì‚¬ ê²°ê³¼ í‘œì‹œ ê°œì„ 
        function showCompletedInspectionResult(inspectionData) {
            const resultMessage = '=== ê²€ì‚¬ ì™„ë£Œ ê²°ê³¼ ===\n' +
                                'ë¶„ë§ëª…: ' + inspectionData.PowderName + '\n' +
                                'LOTë²ˆí˜¸: ' + inspectionData.LotNumber + '\n' +
                                'ê²€ì‚¬ì: ' + inspectionData.Inspector + '\n' +
                                'ê²€ì‚¬ì¼ì‹œ: ' + inspectionData.InspectionTime + '\n' +
                                'ìµœì¢…ê²°ê³¼: ' + (inspectionData.FinalResult === 'PASS' ? 'OK' : 'NG');
            
            alert(resultMessage);
            isProcessingBarcode = false;
        }

        // ì…ë„ë¶„ì„ ì €ì¥ ì „ìš© í•¨ìˆ˜
        function saveParticleSizeItem() {
            console.log('saveParticleSizeItem í•¨ìˆ˜ ì‹œì‘');
            const meshIds = ['180', '150', '106', '75', '45', '45M'];
            const particleData = {};
            let hasValidData = false;
            
            // ê° MESHë³„ ë°ì´í„° ìˆ˜ì§‘
            meshIds.forEach(meshId => {
                console.log('Processing meshId:', meshId);
                
                const input1 = document.getElementById(`ParticleSize${meshId}-1`);
                const input2 = document.getElementById(`ParticleSize${meshId}-2`);
                
                if (!input1 || !input2) {
                    console.error(`ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ParticleSize${meshId}`);
                    return;
                }
                
                const val1 = input1.value;
                const val2 = input2.value;
                
                particleData[meshId] = {
                    val1: val1 || '',
                    val2: val2 || '',
                    avg: document.getElementById(`ParticleSize${meshId}-avg`).textContent,
                    result: document.getElementById(`ParticleSize${meshId}-result`).textContent
                };
                
                if (val1 !== '' || val2 !== '') {
                    hasValidData = true;
                }
            });
            
            if (!hasValidData) {
                alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì¸¡ì •ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            const saveBtn = document.getElementById('ParticleSize-save');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'ì €ì¥ì¤‘...';
            saveBtn.disabled = true;
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result && result.success) {
                        // ì €ì¥ ì„±ê³µ ì²˜ë¦¬
                        saveBtn.textContent = 'ì €ì¥ì™„ë£Œ';
                        saveBtn.className = 'save-btn saved';
                        
                        // ëª¨ë“  ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
                        meshIds.forEach(meshId => {
                            document.getElementById(`ParticleSize${meshId}-1`).disabled = true;
                            document.getElementById(`ParticleSize${meshId}-2`).disabled = true;
                        });
                        
                        // ì™„ë£Œëœ í•­ëª©ì— ì¶”ê°€
                        if (!completedItems.includes('ParticleSize')) {
                            completedItems.push('ParticleSize');
                        }
                        
                        updateInspectionProgress();
                        alert('ì…ë„ë¶„ì„ ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        
                        // ëª¨ë“  í•­ëª© ì™„ë£Œ í™•ì¸
                        if (completedItems.length === currentInspectionItems.length) {
                            if (confirm('ëª¨ë“  ê²€ì‚¬ í•­ëª©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                showPage('dashboard');
                                loadIncompleteInspections();
                            }
                        }
                    } else {
                        alert(result ? result.message : 'ì €ì¥ ì‹¤íŒ¨');
                        saveBtn.textContent = originalText;
                        saveBtn.disabled = false;
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                    saveBtn.textContent = originalText;
                    saveBtn.disabled = false;
                })
                .saveParticleSizeData(
                    currentInspectionData.powderName,
                    currentInspectionData.lotNumber,
                    particleData
                );
        }

        // ê²€ì‚¬ ìƒì„¸ ì¡°íšŒ í™”ë©´ í‘œì‹œ
        function showInspectionDetail(tableRow) {
            const cells = tableRow.querySelectorAll('td');
            const powderName = cells[2].textContent; // ë¶„ë§ëª…
            const lotNumber = cells[3].textContent;   // LOTë²ˆí˜¸
            
            console.log('ê²€ì‚¬ ìƒì„¸ ì¡°íšŒ:', powderName, lotNumber);
            
            // ê²€ì‚¬ ìƒì„¸ ë°ì´í„° ì¡°íšŒ
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result && result.success) {
                        displayInspectionDetail(result.data);
                    } else {
                        alert('ê²€ì‚¬ ìƒì„¸ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ê²€ì‚¬ ìƒì„¸ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                })
                .getInspectionDetail(powderName, lotNumber);
        }

        // ê²€ì‚¬ ìƒì„¸ ë°ì´í„° í‘œì‹œ
        function displayInspectionDetail(inspectionData) {
            // ê¸°ë³¸ ì •ë³´ í‘œì‹œ
            document.getElementById('detailPowderName').textContent = inspectionData.PowderName || '-';
            document.getElementById('detailLotNumber').textContent = inspectionData.LotNumber || '-';
            document.getElementById('detailInspectionType').textContent = inspectionData.InspectionType || '-';
            document.getElementById('detailInspector').textContent = inspectionData.Inspector || '-';
            document.getElementById('detailInspectionTime').textContent = formatDate(inspectionData.InspectionTime) || '-';
            
            // ìµœì¢…ê²°ê³¼ í‘œì‹œ
            const finalResultElement = document.getElementById('detailFinalResult');
            if (inspectionData.FinalResult === 'PASS') {
                finalResultElement.innerHTML = '<span class="result-status pass">OK</span>';
            } else if (inspectionData.FinalResult === 'FAIL') {
                finalResultElement.innerHTML = '<span class="result-status fail">NG</span>';
            } else {
                finalResultElement.textContent = '-';
            }
            
            // ê²€ì‚¬ í•­ëª©ë“¤ í‘œì‹œ
            displayInspectionDetailItems(inspectionData);
            
            // ê²€ì‚¬ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
            showPage('inspectionDetail');
        }

        // ê²€ì‚¬ ìƒì„¸ í•­ëª©ë“¤ í‘œì‹œ
        function displayInspectionDetailItems(inspectionData) {
            const container = document.getElementById('inspectionDetailItems');
            container.innerHTML = '';
            
            // ê²€ì‚¬ í•­ëª©ë“¤ ì •ì˜ (ê·œê²© ì •ë³´ í¬í•¨)
            const inspectionItems = [
                { 
                    name: 'FlowRate', 
                    displayName: 'ìœ ë™ë„', 
                    unit: 's/50g',
                    specColumns: ['FlowRateMin', 'FlowRateMax']
                },
                { 
                    name: 'ApparentDensity', 
                    displayName: 'ê²‰ë³´ê¸°ë°€ë„', 
                    unit: 'g/cmÂ³',
                    specColumns: ['ApparentDensityMin', 'ApparentDensityMax']
                },
                { 
                    name: 'CContent', 
                    displayName: 'Cí•¨ëŸ‰', 
                    unit: '%',
                    specColumns: ['CContentMin', 'CContentMax']
                },
                { 
                    name: 'CuContent', 
                    displayName: 'Cuí•¨ëŸ‰', 
                    unit: '%',
                    specColumns: ['CuContentMin', 'CuContentMax']
                },
                { 
                    name: 'NiContent', 
                    displayName: 'Nií•¨ëŸ‰', 
                    unit: '%',
                    specColumns: ['NiContentMin', 'NiContentMax']
                },
                { 
                    name: 'MoContent', 
                    displayName: 'Moí•¨ëŸ‰', 
                    unit: '%',
                    specColumns: ['MoContentMin', 'MoContentMax']
                },
                { 
                    name: 'SinterChangeRate', 
                    displayName: 'ì†Œê²°ë³€í™”ìœ¨', 
                    unit: '%',
                    specColumns: ['SinterChangeRateMin', 'SinterChangeRateMax']
                },
                { 
                    name: 'SinterStrength', 
                    displayName: 'ì†Œê²°ê°•ë„', 
                    unit: 'MPa',
                    specColumns: ['SinterStrengthMin', 'SinterStrengthMax']
                },
                { 
                    name: 'FormingStrength', 
                    displayName: 'ì„±í˜•ê°•ë„', 
                    unit: 'N',
                    specColumns: ['FormingStrengthMin', 'FormingStrengthMax']
                },
                {
                    name: 'FormingLoad',
                    displayName: 'ì„±í˜•í•˜ì¤‘',
                    unit: 'MPa',
                    specColumns: ['FormingLoadMin', 'FormingLoadMax']
                },
                { 
                    name: 'ParticleSize', 
                    displayName: 'ì…ë„ë¶„ì„', 
                    unit: '%', 
                    isParticleSize: true 
                }
            ];
            
            inspectionItems.forEach(item => {
                if (item.isParticleSize) {
                    const particleSizeCard = createParticleSizeDetailCard(item, inspectionData);
                    container.appendChild(particleSizeCard);
                } else {
                    const detailCard = createInspectionDetailCard(item, inspectionData);
                    container.appendChild(detailCard);
                }
            });
        }

        // ì¼ë°˜ ê²€ì‚¬ í•­ëª© ìƒì„¸ ì¹´ë“œ ìƒì„±
        function createInspectionDetailCard(item, inspectionData) {
            const card = document.createElement('div');
            card.className = 'inspection-detail-card';
            
            const val1 = inspectionData[item.name + '1'] || '';
            const val2 = inspectionData[item.name + '2'] || '';
            const val3 = inspectionData[item.name + '3'] || '';
            const avg = inspectionData[item.name + 'Avg'] || '';
            const result = inspectionData[item.name + 'Result'] || '';
            
            const resultClass = result === 'PASS' ? 'pass' : (result === 'FAIL' ? 'fail' : '');
            const resultText = result === 'PASS' ? 'í•©ê²©' : (result === 'FAIL' ? 'ë¶ˆí•©ê²©' : 'ëŒ€ê¸°ì¤‘');
            
            // ê·œê²© ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            let specRange = '';
            if (inspectionData.powderSpec && item.specColumns) {
                const min = inspectionData.powderSpec[item.specColumns[0]];
                const max = inspectionData.powderSpec[item.specColumns[1]];
                
                if (min !== '' && max !== '') {
                    specRange = `${min} ~ ${max}`;
                } else if (min !== '') {
                    specRange = `â‰¥ ${min}`;
                } else if (max !== '') {
                    specRange = `â‰¤ ${max}`;
                }
            }
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="item-name">${item.displayName}</div>
                    <div class="spec-range">
                        ${item.unit}
                        ${specRange ? `<span style="margin-left: 10px; color: #666; font-size: 0.9em;">(${specRange})</span>` : ''}
                    </div>
                </div>
                
                <div class="detail-measurement-values">
                    <div class="detail-value-item">
                        <div class="detail-value-label">1ì°¨</div>
                        <div class="detail-value-number">${val1 || '-'}</div>
                    </div>
                    <div class="detail-value-item">
                        <div class="detail-value-label">2ì°¨</div>
                        <div class="detail-value-number">${val2 || '-'}</div>
                    </div>
                    <div class="detail-value-item">
                        <div class="detail-value-label">3ì°¨</div>
                        <div class="detail-value-number">${val3 || '-'}</div>
                    </div>
                </div>
                
                <div class="detail-result-display ${resultClass}">
                    <div class="detail-average">í‰ê· : ${avg || '-'} ${item.unit}</div>
                    <div class="avg-result">
                        <div class="result-status ${resultClass}">${resultText}</div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // ì…ë„ë¶„ì„ ìƒì„¸ ì¹´ë“œ ìƒì„± (ì„¸ë¶€ ì…ë ¥ê°’ ëª¨ë‘ í‘œì‹œ)
        function createParticleSizeDetailCard(item, inspectionData) {
            const card = document.createElement('div');
            card.className = 'inspection-detail-card';

            const meshIds = ['180', '150', '106', '75', '45', '45M'];
            let meshResults = '';
            let overallResult = 'PASS';
            
            // ì…ë„ë¶„ì„ ê·œê²© ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            let particleSizeSpecs = [];
            if (inspectionData.powderSpec) {
                // ParticleSize ê·œê²©ì´ ìˆëŠ”ì§€ í™•ì¸ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë³„ë„ í•¨ìˆ˜ í•„ìš”)
                // ì—¬ê¸°ì„œëŠ” ê¸°ë³¸ êµ¬ì¡°ë§Œ ì œì‹œ
            }
            
            meshIds.forEach(meshId => {
                const val1 = inspectionData[`ParticleSize${meshId}_1`] || '';
                const val2 = inspectionData[`ParticleSize${meshId}_2`] || '';
                const avg = inspectionData[`ParticleSize${meshId}_Avg`] || '';
                const result = inspectionData[`ParticleSize${meshId}_Result`] || '';
                
                if (result === 'FAIL') {
                    overallResult = 'FAIL';
                }
                
                const resultClass = result === 'PASS' ? 'pass' : (result === 'FAIL' ? 'fail' : '');
                const resultText = result === 'PASS' ? 'í•©ê²©' : (result === 'FAIL' ? 'ë¶ˆí•©ê²©' : 'ëŒ€ê¸°ì¤‘');
                
                // MESH ì´ë¦„ í‘œì‹œ ê°œì„ 
                let meshDisplayName = '';
                if (meshId === '325M') {
                    meshDisplayName = '-325#';
                } else {
                    meshDisplayName = `+${meshId}#`;
                }
                
                // í•´ë‹¹ MESHì˜ ê·œê²© ì •ë³´ ì°¾ê¸° (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë³„ë„ í•¨ìˆ˜ í•„ìš”)
                let meshSpec = '';
                // particleSizeSpecsì—ì„œ í•´ë‹¹ MESH ê·œê²© ì°¾ê¸°
                
                meshResults += `
                    <div class="mesh-group">
                        <div class="mesh-header">
                            <span class="mesh-name">${meshDisplayName}</span>
                            <span class="mesh-spec">
                                í‰ê· : ${avg || '-'}%
                                ${meshSpec ? `<span style="margin-left: 10px; color: #666; font-size: 0.8em;">(${meshSpec})</span>` : ''}
                            </span>
                        </div>
                        
                        <div class="detail-measurement-values">
                            <div class="detail-value-item">
                                <div class="detail-value-label">1íšŒ ì¸¡ì •</div>
                                <div class="detail-value-number">${val1 || '-'}%</div>
                            </div>
                            <div class="detail-value-item">
                                <div class="detail-value-label">2íšŒ ì¸¡ì •</div>
                                <div class="detail-value-number">${val2 || '-'}%</div>
                            </div>
                        </div>
                        
                        <div class="mesh-result">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                                <span style="font-weight: bold; color: #495057;">ê²°ê³¼:</span>
                                <span class="result-status ${resultClass}">${resultText}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            const overallResultClass = overallResult === 'PASS' ? 'pass' : 'fail';
            const overallResultText = overallResult === 'PASS' ? 'í•©ê²©' : 'ë¶ˆí•©ê²©';
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="item-name">${item.displayName}</div>
                    <div class="spec-range">ì…ë„ë¶„ì„ ìƒì„¸ ê²°ê³¼</div>
                </div>
                
                <div class="particle-size-inputs">
                    ${meshResults}
                </div>
                
                <div class="detail-result-display ${overallResultClass}">
                    <div class="avg-result">
                        <div style="text-align: center; margin-bottom: 10px;">
                            <strong style="font-size: 1.1em;">ì „ì²´ ì…ë„ë¶„ì„ ê²°ê³¼</strong>
                        </div>
                        <div style="text-align: center;">
                            <span class="result-status ${overallResultClass}" style="font-size: 1.1em; padding: 8px 16px;">
                                ${overallResultText}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // ê²‰ë³´ê¸°ë°€ë„ ì „ìš© ì¹´ë“œ ìƒì„± (ìˆ˜ì •)
        function createApparentDensityCard(item, isCompleted) {
            const card = document.createElement('div');
            card.className = 'inspection-card';
            card.id = `card-${item.name}`;

            const specRange = (item.min !== '' && item.max !== '') ? 
                `${item.min} ~ ${item.max}` :
                (item.min !== '' ? `â‰¥ ${item.min}` : `â‰¤ ${item.max}`);
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="item-name">${item.displayName}</div>
                    <div class="spec-range">${specRange} ${item.unit}</div>
                </div>
                
                <div class="apparent-density-inputs">
                    <div class="apparent-density-row">
                        <label>1ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-emptyCup1" 
                              oninput="calculateApparentDensity('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ë¹ˆì»µì¤‘ëŸ‰">
                        <input type="number" step="any" id="${item.name}-powderWeight1" 
                              oninput="calculateApparentDensity('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ë¶„ë§ì¤‘ëŸ‰">
                        <div class="unit">g</div>
                        <div class="calculated-value" id="${item.name}-calculated1">-</div>
                    </div>
                    <div class="apparent-density-row">
                        <label>2ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-emptyCup2" 
                              oninput="calculateApparentDensity('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ë¹ˆì»µì¤‘ëŸ‰">
                        <input type="number" step="any" id="${item.name}-powderWeight2" 
                              oninput="calculateApparentDensity('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ë¶„ë§ì¤‘ëŸ‰">
                        <div class="unit">g</div>
                        <div class="calculated-value" id="${item.name}-calculated2">-</div>
                    </div>
                    <div class="apparent-density-row">
                        <label>3ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-emptyCup3" 
                              oninput="calculateApparentDensity('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ë¹ˆì»µì¤‘ëŸ‰">
                        <input type="number" step="any" id="${item.name}-powderWeight3" 
                              oninput="calculateApparentDensity('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ë¶„ë§ì¤‘ëŸ‰">
                        <div class="unit">g</div>
                        <div class="calculated-value" id="${item.name}-calculated3">-</div>
                    </div>
                </div>
                
                <div class="calculation-result">
                    <div class="avg-result">
                        <div>
                            <strong>í‰ê· ê°’: </strong>
                            <span class="avg-value" id="${item.name}-avg">-</span>
                            <span style="color: #666; font-size: 0.9em;">${item.unit}</span>
                        </div>
                        <div class="result-status pending" id="${item.name}-result">ëŒ€ê¸°ì¤‘</div>
                    </div>
                </div>
                
                <button class="save-btn ${isCompleted ? 'saved' : ''}" 
                        id="${item.name}-save" 
                        onclick="saveInspectionItem('${item.name}')"
                        ${isCompleted ? 'disabled' : ''}>
                    ${isCompleted ? 'ì €ì¥ì™„ë£Œ' : 'ì €ì¥'}
                </button>
            `;
            
            return card;
        }

        // ê²‰ë³´ê¸°ë°€ë„ ì €ì¥ í•¨ìˆ˜ (í´ë¼ì´ì–¸íŠ¸ì‚¬ì´ë“œ - ì´ë¦„ ë³€ê²½)
        function saveApparentDensityItemClient() {
            const values = [];
            
            // 1ì°¨, 2ì°¨, 3ì°¨ ë°ì´í„° ìˆ˜ì§‘
            for (let i = 1; i <= 3; i++) {
                const emptyCup = document.getElementById('ApparentDensity-emptyCup' + i).value;
                const powderWeight = document.getElementById('ApparentDensity-powderWeight' + i).value;
                values.push(emptyCup, powderWeight);
            }
            
            // ìœ íš¨í•œ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
            const hasValidData = values.some(v => v !== '' && !isNaN(v));
            if (!hasValidData) {
                alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì¸¡ì •ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© ìƒíƒœ
            const saveBtn = document.getElementById('ApparentDensity-save');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'ì €ì¥ì¤‘...';
            saveBtn.disabled = true;
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result && result.success) {
                        // ì €ì¥ ì„±ê³µ ì²˜ë¦¬
                        saveBtn.textContent = 'ì €ì¥ì™„ë£Œ';
                        saveBtn.className = 'save-btn saved';
                        
                        // ëª¨ë“  ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
                        for (let i = 1; i <= 3; i++) {
                            document.getElementById('ApparentDensity-emptyCup' + i).disabled = true;
                            document.getElementById('ApparentDensity-powderWeight' + i).disabled = true;
                        }
                        
                        // ì™„ë£Œëœ í•­ëª©ì— ì¶”ê°€
                        if (!completedItems.includes('ApparentDensity')) {
                            completedItems.push('ApparentDensity');
                        }
                        
                        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
                        updateInspectionProgress();
                        
                        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        
                        // ëª¨ë“  í•­ëª© ì™„ë£Œ ì‹œ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ ì œì•ˆ
                        if (completedItems.length === currentInspectionItems.length) {
                            if (confirm('ëª¨ë“  ê²€ì‚¬ í•­ëª©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                showPage('dashboard');
                                loadIncompleteInspections();
                            }
                        }
                    } else {
                        alert(result ? result.message : 'ì €ì¥ ì‹¤íŒ¨');
                        saveBtn.textContent = originalText;
                        saveBtn.disabled = false;
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                    saveBtn.textContent = originalText;
                    saveBtn.disabled = false;
                })
                .saveApparentDensityItem(
                    currentInspectionData.powderName,
                    currentInspectionData.lotNumber,
                    values
                );
        }

        // ìˆ˜ë¶„ë„ ì „ìš© ì¹´ë“œ ìƒì„±
        function createMoistureCard(item, isCompleted) {
            const card = document.createElement('div');
            card.className = 'inspection-card';
            card.id = `card-${item.name}`;

            const specRange = (item.min !== '' && item.max !== '') ?
                `${item.min} ~ ${item.max}` :
                (item.min !== '' ? `â‰¥ ${item.min}` : `â‰¤ ${item.max}`);

            card.innerHTML = `
                <div class="card-header">
                    <div class="item-name">${item.displayName}</div>
                    <div class="spec-range">${specRange} ${item.unit}</div>
                </div>

                <div class="apparent-density-inputs">
                    <div class="apparent-density-row">
                        <label>1ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-initialWeight1"
                              oninput="calculateMoisture('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ì´ˆê¸°ì¤‘ëŸ‰">
                        <input type="number" step="any" id="${item.name}-driedWeight1"
                              oninput="calculateMoisture('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ê±´ì¡°í›„ì¤‘ëŸ‰">
                        <div class="unit">g</div>
                        <div class="calculated-value" id="${item.name}-calculated1">-</div>
                    </div>
                    <div class="apparent-density-row">
                        <label>2ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-initialWeight2"
                              oninput="calculateMoisture('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ì´ˆê¸°ì¤‘ëŸ‰">
                        <input type="number" step="any" id="${item.name}-driedWeight2"
                              oninput="calculateMoisture('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ê±´ì¡°í›„ì¤‘ëŸ‰">
                        <div class="unit">g</div>
                        <div class="calculated-value" id="${item.name}-calculated2">-</div>
                    </div>
                    <div class="apparent-density-row">
                        <label>3ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-initialWeight3"
                              oninput="calculateMoisture('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ì´ˆê¸°ì¤‘ëŸ‰">
                        <input type="number" step="any" id="${item.name}-driedWeight3"
                              oninput="calculateMoisture('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ê±´ì¡°í›„ì¤‘ëŸ‰">
                        <div class="unit">g</div>
                        <div class="calculated-value" id="${item.name}-calculated3">-</div>
                    </div>
                </div>

                <div class="calculation-result">
                    <div class="avg-result">
                        <div>
                            <strong>í‰ê· ê°’: </strong>
                            <span class="avg-value" id="${item.name}-avg">-</span>
                            <span style="color: #666; font-size: 0.9em;">${item.unit}</span>
                        </div>
                        <div class="result-status pending" id="${item.name}-result">ëŒ€ê¸°ì¤‘</div>
                    </div>
                </div>

                <button class="save-btn ${isCompleted ? 'saved' : ''}"
                        id="${item.name}-save"
                        onclick="saveInspectionItem('${item.name}')"
                        ${isCompleted ? 'disabled' : ''}>
                    ${isCompleted ? 'ì €ì¥ì™„ë£Œ' : 'ì €ì¥'}
                </button>
            `;

            return card;
        }

        // íšŒë¶„ë„ ì „ìš© ì¹´ë“œ ìƒì„±
        function createAshCard(item, isCompleted) {
            const card = document.createElement('div');
            card.className = 'inspection-card';
            card.id = `card-${item.name}`;

            const specRange = (item.min !== '' && item.max !== '') ?
                `${item.min} ~ ${item.max}` :
                (item.min !== '' ? `â‰¥ ${item.min}` : `â‰¤ ${item.max}`);

            card.innerHTML = `
                <div class="card-header">
                    <div class="item-name">${item.displayName}</div>
                    <div class="spec-range">${specRange} ${item.unit}</div>
                </div>

                <div class="apparent-density-inputs">
                    <div class="apparent-density-row">
                        <label>1ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-initialWeight1"
                              oninput="calculateAsh('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ì´ˆê¸°ì¤‘ëŸ‰">
                        <input type="number" step="any" id="${item.name}-ashWeight1"
                              oninput="calculateAsh('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="íšŒë¶„ì¤‘ëŸ‰">
                        <div class="unit">g</div>
                        <div class="calculated-value" id="${item.name}-calculated1">-</div>
                    </div>
                    <div class="apparent-density-row">
                        <label>2ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-initialWeight2"
                              oninput="calculateAsh('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ì´ˆê¸°ì¤‘ëŸ‰">
                        <input type="number" step="any" id="${item.name}-ashWeight2"
                              oninput="calculateAsh('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="íšŒë¶„ì¤‘ëŸ‰">
                        <div class="unit">g</div>
                        <div class="calculated-value" id="${item.name}-calculated2">-</div>
                    </div>
                    <div class="apparent-density-row">
                        <label>3ì°¨:</label>
                        <input type="number" step="any" id="${item.name}-initialWeight3"
                              oninput="calculateAsh('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="ì´ˆê¸°ì¤‘ëŸ‰">
                        <input type="number" step="any" id="${item.name}-ashWeight3"
                              oninput="calculateAsh('${item.name}')"
                              ${isCompleted ? 'disabled' : ''} placeholder="íšŒë¶„ì¤‘ëŸ‰">
                        <div class="unit">g</div>
                        <div class="calculated-value" id="${item.name}-calculated3">-</div>
                    </div>
                </div>

                <div class="calculation-result">
                    <div class="avg-result">
                        <div>
                            <strong>í‰ê· ê°’: </strong>
                            <span class="avg-value" id="${item.name}-avg">-</span>
                            <span style="color: #666; font-size: 0.9em;">${item.unit}</span>
                        </div>
                        <div class="result-status pending" id="${item.name}-result">ëŒ€ê¸°ì¤‘</div>
                    </div>
                </div>

                <button class="save-btn ${isCompleted ? 'saved' : ''}"
                        id="${item.name}-save"
                        onclick="saveInspectionItem('${item.name}')"
                        ${isCompleted ? 'disabled' : ''}>
                    ${isCompleted ? 'ì €ì¥ì™„ë£Œ' : 'ì €ì¥'}
                </button>
            `;

            return card;
        }

        // ìˆ˜ë¶„ë„ ê³„ì‚° í•¨ìˆ˜: ((ì´ˆê¸°ì¤‘ëŸ‰ - ê±´ì¡°í›„ì¤‘ëŸ‰) / ì´ˆê¸°ì¤‘ëŸ‰) * 100
        function calculateMoisture(itemName) {
            const moistureValues = [];

            for (let i = 1; i <= 3; i++) {
                const initialWeight = parseFloat(document.getElementById(itemName + '-initialWeight' + i).value);
                const driedWeight = parseFloat(document.getElementById(itemName + '-driedWeight' + i).value);
                const calculatedDiv = document.getElementById(itemName + '-calculated' + i);

                if (!isNaN(initialWeight) && !isNaN(driedWeight) && initialWeight > 0) {
                    const moisture = ((initialWeight - driedWeight) / initialWeight) * 100;
                    calculatedDiv.textContent = moisture.toFixed(2) + '%';
                    moistureValues.push(moisture);
                } else {
                    calculatedDiv.textContent = '-';
                }
            }

            // í‰ê·  ë° í•©ê²©/ë¶ˆí•©ê²© íŒì •
            const avgSpan = document.getElementById(itemName + '-avg');
            const resultDiv = document.getElementById(itemName + '-result');

            if (moistureValues.length > 0) {
                const average = moistureValues.reduce((sum, val) => sum + val, 0) / moistureValues.length;
                avgSpan.textContent = average.toFixed(2);

                const currentItem = currentInspectionItems.find(item => item.name === itemName);
                if (currentItem) {
                    let result = 'PASS';
                    if (currentItem.min !== '' && average < parseFloat(currentItem.min)) result = 'FAIL';
                    if (currentItem.max !== '' && average > parseFloat(currentItem.max)) result = 'FAIL';

                    resultDiv.textContent = result === 'PASS' ? 'í•©ê²©' : 'ë¶ˆí•©ê²©';
                    resultDiv.className = result === 'PASS' ? 'result-status pass' : 'result-status fail';
                }
            } else {
                avgSpan.textContent = '-';
                resultDiv.textContent = 'ëŒ€ê¸°ì¤‘';
                resultDiv.className = 'result-status pending';
            }
        }

        // íšŒë¶„ë„ ê³„ì‚° í•¨ìˆ˜: (íšŒë¶„ì¤‘ëŸ‰ / ì´ˆê¸°ì¤‘ëŸ‰) * 100
        function calculateAsh(itemName) {
            const ashValues = [];

            for (let i = 1; i <= 3; i++) {
                const initialWeight = parseFloat(document.getElementById(itemName + '-initialWeight' + i).value);
                const ashWeight = parseFloat(document.getElementById(itemName + '-ashWeight' + i).value);
                const calculatedDiv = document.getElementById(itemName + '-calculated' + i);

                if (!isNaN(initialWeight) && !isNaN(ashWeight) && initialWeight > 0) {
                    const ash = (ashWeight / initialWeight) * 100;
                    calculatedDiv.textContent = ash.toFixed(2) + '%';
                    ashValues.push(ash);
                } else {
                    calculatedDiv.textContent = '-';
                }
            }

            // í‰ê·  ë° í•©ê²©/ë¶ˆí•©ê²© íŒì •
            const avgSpan = document.getElementById(itemName + '-avg');
            const resultDiv = document.getElementById(itemName + '-result');

            if (ashValues.length > 0) {
                const average = ashValues.reduce((sum, val) => sum + val, 0) / ashValues.length;
                avgSpan.textContent = average.toFixed(2);

                const currentItem = currentInspectionItems.find(item => item.name === itemName);
                if (currentItem) {
                    let result = 'PASS';
                    if (currentItem.min !== '' && average < parseFloat(currentItem.min)) result = 'FAIL';
                    if (currentItem.max !== '' && average > parseFloat(currentItem.max)) result = 'FAIL';

                    resultDiv.textContent = result === 'PASS' ? 'í•©ê²©' : 'ë¶ˆí•©ê²©';
                    resultDiv.className = result === 'PASS' ? 'result-status pass' : 'result-status fail';
                }
            } else {
                avgSpan.textContent = '-';
                resultDiv.textContent = 'ëŒ€ê¸°ì¤‘';
                resultDiv.className = 'result-status pending';
            }
        }

        // ìˆ˜ë¶„ë„ ì €ì¥ í•¨ìˆ˜ (í´ë¼ì´ì–¸íŠ¸ì‚¬ì´ë“œ)
        function saveMoistureItemClient() {
            const values = [];

            for (let i = 1; i <= 3; i++) {
                const initialWeight = document.getElementById('Moisture-initialWeight' + i).value;
                const driedWeight = document.getElementById('Moisture-driedWeight' + i).value;
                values.push(initialWeight, driedWeight);
            }

            const hasValidData = values.some(v => v !== '' && !isNaN(v));
            if (!hasValidData) {
                alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì¸¡ì •ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const saveBtn = document.getElementById('Moisture-save');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'ì €ì¥ì¤‘...';
            saveBtn.disabled = true;

            google.script.run
                .withSuccessHandler(function(result) {
                    if (result && result.success) {
                        saveBtn.textContent = 'ì €ì¥ì™„ë£Œ';
                        saveBtn.className = 'save-btn saved';

                        for (let i = 1; i <= 3; i++) {
                            document.getElementById('Moisture-initialWeight' + i).disabled = true;
                            document.getElementById('Moisture-driedWeight' + i).disabled = true;
                        }

                        if (!completedItems.includes('Moisture')) {
                            completedItems.push('Moisture');
                        }

                        updateInspectionProgress();
                        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');

                        if (completedItems.length === currentInspectionItems.length) {
                            if (confirm('ëª¨ë“  ê²€ì‚¬ í•­ëª©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                showPage('dashboard');
                                loadIncompleteInspections();
                            }
                        }
                    } else {
                        alert(result ? result.message : 'ì €ì¥ ì‹¤íŒ¨');
                        saveBtn.textContent = originalText;
                        saveBtn.disabled = false;
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                    saveBtn.textContent = originalText;
                    saveBtn.disabled = false;
                })
                .saveMoistureItem(
                    currentInspectionData.powderName,
                    currentInspectionData.lotNumber,
                    values
                );
        }

        // íšŒë¶„ë„ ì €ì¥ í•¨ìˆ˜ (í´ë¼ì´ì–¸íŠ¸ì‚¬ì´ë“œ)
        function saveAshItemClient() {
            const values = [];

            for (let i = 1; i <= 3; i++) {
                const initialWeight = document.getElementById('Ash-initialWeight' + i).value;
                const ashWeight = document.getElementById('Ash-ashWeight' + i).value;
                values.push(initialWeight, ashWeight);
            }

            const hasValidData = values.some(v => v !== '' && !isNaN(v));
            if (!hasValidData) {
                alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì¸¡ì •ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const saveBtn = document.getElementById('Ash-save');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'ì €ì¥ì¤‘...';
            saveBtn.disabled = true;

            google.script.run
                .withSuccessHandler(function(result) {
                    if (result && result.success) {
                        saveBtn.textContent = 'ì €ì¥ì™„ë£Œ';
                        saveBtn.className = 'save-btn saved';

                        for (let i = 1; i <= 3; i++) {
                            document.getElementById('Ash-initialWeight' + i).disabled = true;
                            document.getElementById('Ash-ashWeight' + i).disabled = true;
                        }

                        if (!completedItems.includes('Ash')) {
                            completedItems.push('Ash');
                        }

                        updateInspectionProgress();
                        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');

                        if (completedItems.length === currentInspectionItems.length) {
                            if (confirm('ëª¨ë“  ê²€ì‚¬ í•­ëª©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                showPage('dashboard');
                                loadIncompleteInspections();
                            }
                        }
                    } else {
                        alert(result ? result.message : 'ì €ì¥ ì‹¤íŒ¨');
                        saveBtn.textContent = originalText;
                        saveBtn.disabled = false;
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.toString());
                    saveBtn.textContent = originalText;
                    saveBtn.disabled = false;
                })
                .saveAshItem(
                    currentInspectionData.powderName,
                    currentInspectionData.lotNumber,
                    values
                );
        }

        // ========== ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ==========

        // ê²€ì‚¬ ê²°ê³¼ ìˆ˜ì • í•¨ìˆ˜
        function editInspection(powderName, lotNumber) {
            if (!confirm(`${powderName} (LOT: ${lotNumber})ì˜ ê²€ì‚¬ ê²°ê³¼ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            // ê²€ì‚¬ ë°ì´í„° ë¡œë“œ
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        // ê²€ì‚¬ ë°ì´í„°ë¥¼ í˜„ì¬ ê²€ì‚¬ ë°ì´í„°ë¡œ ì„¤ì •
                        currentInspectionData = {
                            powderName: result.data.PowderName,
                            lotNumber: result.data.LotNumber,
                            inspector: result.data.Inspector,
                            inspectionType: result.data.InspectionType,
                            isEditing: true // ìˆ˜ì • ëª¨ë“œ í”Œë˜ê·¸
                        };
                        
                        // ê²€ì‚¬ í•­ëª© ë¡œë“œ
                        google.script.run
                            .withSuccessHandler(function(items) {
                                currentInspectionItems = items;
                                completedItems = []; // ìˆ˜ì • ëª¨ë“œì—ì„œëŠ” ì™„ë£Œ í•­ëª© ì´ˆê¸°í™”

                                // ê²€ì‚¬ í˜ì´ì§€ë¡œ ì´ë™
                                showPage('inspection');
                                displayInspectionItems();

                                // ìˆ˜ì • ëª¨ë“œì¼ ë•Œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
                                const backBtn = document.getElementById('backToDashboardBtn');
                                if (backBtn) {
                                    backBtn.textContent = 'ê²€ì‚¬ê²°ê³¼ ì¡°íšŒë¡œ ëŒì•„ê°€ê¸°';
                                    backBtn.onclick = function() {
                                        showPage('search');
                                    };
                                }

                                // ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
                                setTimeout(function() {
                                    loadExistingData(result.data);
                                    updateInspectionProgress();
                                }, 300);
                            })
                            .withFailureHandler(function(error) {
                                alert('ê²€ì‚¬ í•­ëª© ë¡œë“œ ì‹¤íŒ¨: ' + error);
                            })
                            .getInspectionItems(powderName, result.data.InspectionType);
                    } else {
                        alert(result.message || 'ê²€ì‚¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error);
                })
                .getInspectionDetail(powderName, lotNumber);
        }

        // ê¸°ì¡´ ë°ì´í„°ë¥¼ ì…ë ¥ í•„ë“œì— ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
        function loadExistingData(data) {
            console.log('ê¸°ì¡´ ë°ì´í„° ë¡œë“œ ì‹œì‘:', data);
            
            // ê° ê²€ì‚¬ í•­ëª©ë³„ë¡œ ë°ì´í„° ë¡œë“œ
            currentInspectionItems.forEach(item => {
                const itemName = item.name;
                
                if (itemName === 'ParticleSize') {
                    // ì…ë„ë¶„ì„ ë°ì´í„° ë¡œë“œ
                    loadParticleSizeData(data);
                } else if (itemName === 'ApparentDensity') {
                    // ê²‰ë³´ê¸°ë°€ë„ ë°ì´í„° ë¡œë“œ
                    loadApparentDensityData(data);
                } else {
                    // ì¼ë°˜ í•­ëª© ë°ì´í„° ë¡œë“œ
                    loadGeneralItemData(itemName, data);
                }
            });
        }

        // ì¼ë°˜ í•­ëª© ë°ì´í„° ë¡œë“œ
        function loadGeneralItemData(itemName, data) {
            let hasData = false;
            
            for (let i = 1; i <= 3; i++) {
                const colName = itemName + i;
                const inputElement = document.getElementById(`${itemName}-${i}`);
                
                if (inputElement && data[colName] !== undefined && data[colName] !== '') {
                    inputElement.value = data[colName];
                    hasData = true;
                }
            }
            
            // ë°ì´í„°ê°€ ìˆìœ¼ë©´ í‰ê·  ê³„ì‚°
            if (hasData) {
                calculateAverage(itemName);
            }
        }

        // ê²‰ë³´ê¸°ë°€ë„ ë°ì´í„° ë¡œë“œ
        function loadApparentDensityData(data) {
            let hasData = false;
            
            // ì›ë³¸ ë°ì´í„°(ë¹ˆì»µì¤‘ëŸ‰, ë¶„ë§ì¤‘ëŸ‰) ë¡œë“œ
            for (let i = 1; i <= 3; i++) {
                const emptyCupCol = 'ApparentDensity_EmptyCup' + i;
                const powderWeightCol = 'ApparentDensity_PowderWeight' + i;
                
                const emptyCupInput = document.getElementById('ApparentDensity-emptyCup' + i);
                const powderWeightInput = document.getElementById('ApparentDensity-powderWeight' + i);
                
                // ì›ë³¸ ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš° (ìƒˆ í˜•ì‹)
                if (data[emptyCupCol] !== undefined && data[emptyCupCol] !== '') {
                    if (emptyCupInput) {
                        emptyCupInput.value = data[emptyCupCol];
                        hasData = true;
                    }
                }
                
                if (data[powderWeightCol] !== undefined && data[powderWeightCol] !== '') {
                    if (powderWeightInput) {
                        powderWeightInput.value = data[powderWeightCol];
                        hasData = true;
                    }
                }
            }
            
            // ì›ë³¸ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê³„ì‚°
            if (hasData) {
                calculateApparentDensity('ApparentDensity');
            } else {
                // ì›ë³¸ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° (êµ¬ í˜•ì‹) - ìˆ˜ì • ë¶ˆê°€ ì²˜ë¦¬
                for (let i = 1; i <= 3; i++) {
                    const emptyCupInput = document.getElementById('ApparentDensity-emptyCup' + i);
                    const powderWeightInput = document.getElementById('ApparentDensity-powderWeight' + i);
                    
                    if (emptyCupInput) {
                        emptyCupInput.disabled = true;
                        emptyCupInput.style.backgroundColor = '#f5f5f5';
                        emptyCupInput.placeholder = 'êµ¬ë²„ì „ ë°ì´í„°';
                    }
                    if (powderWeightInput) {
                        powderWeightInput.disabled = true;
                        powderWeightInput.style.backgroundColor = '#f5f5f5';
                        powderWeightInput.placeholder = 'êµ¬ë²„ì „ ë°ì´í„°';
                    }
                    
                    // ê³„ì‚°ëœ ê°’ë§Œ í‘œì‹œ
                    const densityCol = 'ApparentDensity' + i;
                    if (data[densityCol] !== undefined && data[densityCol] !== '') {
                        const calculatedDiv = document.getElementById('ApparentDensity-calculated' + i);
                        if (calculatedDiv) {
                            calculatedDiv.textContent = parseFloat(data[densityCol]).toFixed(3) + ' g/cmÂ³';
                        }
                    }
                }
                
                // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
                const saveBtn = document.getElementById('ApparentDensity-save');
                if (saveBtn) {
                    saveBtn.disabled = true;
                    saveBtn.textContent = 'êµ¬ë²„ì „ ë°ì´í„°';
                    saveBtn.className = 'save-btn saved';
                }
                
                // í‰ê· ê°’ í‘œì‹œ
                if (data.ApparentDensityAvg) {
                    const avgSpan = document.getElementById('ApparentDensity-avg');
                    if (avgSpan) avgSpan.textContent = parseFloat(data.ApparentDensityAvg).toFixed(3);
                }
                
                // ê²°ê³¼ í‘œì‹œ
                if (data.ApparentDensityResult) {
                    const resultDiv = document.getElementById('ApparentDensity-result');
                    if (resultDiv) {
                        resultDiv.className = data.ApparentDensityResult === 'PASS' ? 'result-status pass' : 'result-status fail';
                        resultDiv.textContent = data.ApparentDensityResult === 'PASS' ? 'í•©ê²©' : 'ë¶ˆí•©ê²©';
                    }
                }
            }
        }

        // ì…ë„ë¶„ì„ ë°ì´í„° ë¡œë“œ
        function loadParticleSizeData(data) {
            const meshIds = ['180', '150', '106', '75', '45', '45M'];
            let hasData = false;
            
            meshIds.forEach(meshId => {
                const val1Col = 'ParticleSize' + meshId + '_1';
                const val2Col = 'ParticleSize' + meshId + '_2';
                
                const input1 = document.getElementById('ParticleSize' + meshId + '-1');
                const input2 = document.getElementById('ParticleSize' + meshId + '-2');
                
                if (input1 && data[val1Col] !== undefined && data[val1Col] !== '') {
                    input1.value = data[val1Col];
                    hasData = true;
                }
                
                if (input2 && data[val2Col] !== undefined && data[val2Col] !== '') {
                    input2.value = data[val2Col];
                    hasData = true;
                }
            });
            
            // ë°ì´í„°ê°€ ìˆìœ¼ë©´ í‰ê·  ê³„ì‚°
            if (hasData) {
                calculateParticleSizeAverages();
            }
        }

        // ê²€ì‚¬ ê²°ê³¼ ì‚­ì œ í•¨ìˆ˜
        function deleteInspection(powderName, lotNumber) {
            if (!confirm(`${powderName} (LOT: ${lotNumber})ì˜ ê²€ì‚¬ ê²°ê³¼ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                return;
            }
            
            // í•œ ë²ˆ ë” í™•ì¸
            if (!confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        // ê²€ìƒ‰ ê²°ê³¼ ìƒˆë¡œê³ ì¹¨
                        performSearch();
                    } else {
                        alert(result.message || 'ì‚­ì œ ì‹¤íŒ¨');
                    }
                })
                .withFailureHandler(function(error) {
                    alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error);
                })
                .deleteInspectionResult(powderName, lotNumber);
        }

    </script>
</body>
</html>
